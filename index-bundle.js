(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){window.alert('This is a prototype app to deomonstrate the algorithm described in "Generating Tile Maps", McNeill and Hale, EuroVis, 2017.\n\nNotes:\n\n- Click on underlined labels for more information.\n\n- DO NOT attempt to generate lots of candidate tile maps when there are many regions.\n\n- An alert may pop up indicating that a script is taking a long time; check "Don\'t ask me again" and click "Continue" or "OK".');undefined;(function(L2_f){L2.aux.onLoad(L2_f)})(function(){var L2_Ops=new L2.ArJSA([undefined]);var L2_Tile=(L2.assert.notBr(),L2.aux.modulePost(require("tile.js")));var L2_circle=false;var L2_AllGeoOps=L2.sc.pairMult("africa-country",new L2.Box(L2.sc.pairMult("width",600,"fontSize",11)["info:"](7)),"usa-state",new L2.Box(L2.sc.pairMult("width",800,"fontSize",11)["info:"](7)),"usa-california-county",new L2.Box(L2.sc.pairMult("width",550,"fontSize",11)["info:"](7)),"uk-london-borough",new L2.Box(L2.sc.pairMult("width",500,"fontSize",11)["info:"](7)),"uk-local-authority",new L2.Box(L2.sc.pairMult("width",600,"fontSize",11)["info:"](3)),"uk-constit",new L2.Box(L2.sc.pairMult("width",600,"fontSize",10)["info:"](3)),"france-department",new L2.Box(L2.sc.pairMult("width",700,"fontSize",11)["info:"](7)),"china-prefecture",new L2.Box(L2.sc.pairMult("width",600,"fontSize",11)["info:"](3)));var L2_GeoOps=new L2.ArJSA([]);var L2_ops_=L2.html(document.querySelectorAll(".option"));var L2_par_=L2.html(document.querySelectorAll(".param"));var L2_plot_main_=L2.html(document.querySelectorAll("#plot_main"));var L2_plot_cost_=L2.html(document.querySelectorAll("#plot_cost"));var L2_option_form_=L2.html(document.querySelectorAll("#option_form"));var L2_detail_group_=L2.html(document.querySelectorAll("#mask, #detail_wrap"));var L2_detail_=L2.html(document.querySelectorAll("#detail"));var L2_cost_show_form_=L2.html(document.querySelectorAll("#cost_show_form"));var L2_busy_=L2.html(document.querySelectorAll("#busy"));var L2_hide=function(L2_el){if(L2_el instanceof L2.Ar)L2_el=L2_el.v[0];return L2_el._html_.setGen(["setStyle","display","none"])};var L2_show=function(L2_el){if(L2_el instanceof L2.Ar)L2_el=L2_el.v[0];return L2_el._html_.setGen(["setStyle","display","block"])};var L2_val=function(L2_el){if(L2_el instanceof L2.Ar)L2_el=L2_el.v[0];return L2_el._html_.getGen("prop","value")};var L2_id=function(L2_el){if(L2_el instanceof L2.Ar)L2_el=L2_el.v[0];return L2_el._html_.getGen("attr","id")};var L2_clear=function(L2_el){if(L2_el instanceof L2.Ar)L2_el=L2_el.v[0];return L2_el._html_.setGen(["setProp","innerHTML",""])};var L2_updateGridCount=function(){return L2.html(document.querySelectorAll("#grid_count"))._html_.setGen(["setProp","innerHTML",L2_Ops["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A.r})["prod"]("r")])};var L2_Data=L2.sc.pairNone();L2_Ops=L2.tab(L2_val(L2_ops_))["key:"]("r",undefined,L2.tab(L2_id(L2_ops_)))["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.sc.split(L2_A.v[0],",")._mapMeth("trim")});L2.sca(L2_updateGridCount());L2.html(document.querySelectorAll(".param_output"))._html_.setGen(["setProp","innerHTML",L2.tab(L2_val(L2_par_))]);(function(L2_f){L2.html(document.querySelectorAll(".more-info"))._html_.on("click",L2_f)})(function(L2_evt){if(L2_evt instanceof L2.Ar)L2_evt=L2_evt.v[0];var L2_msg=L2.html([L2_evt._event_.currentTarget])._html_.checkElmt()._html_.getGen("attr","title").v[0];window.alert(L2_msg);undefined});var L2_createGrid=function(){var L2_GridOps=new L2.ArCopy(L2_Ops,true)._dPush("tile",L2.sca(L2_val(L2.html(document.querySelectorAll("#shape")))));L2_GridOps._oneDimSetAr("r",new L2.ArJSA(["noise","displace"])._appendSc("smooth","r"),L2_GridOps._oneDimAr("r",new L2.ArJSA(["noise","displace"])._appendSc("smooth","r"))["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A._map(L2.pf.ew.num)}));L2_GridOps._dPush("repel",L2.html(document.querySelectorAll("#repel"))._html_.getGen("prop","checked").v[0])._dPush("concav",L2.pf.ew.num(L2.sca(L2_val(L2.html(document.querySelectorAll("#concav"))))));L2.tab(L2_Tile._dEnt("tileMap")(L2_Data,L2_GridOps));L2.sca(L2_show(L2.html(document.querySelectorAll("#param_wrap"))));L2.sca(L2_plotMain());L2.sca(L2_hide(L2_busy_))};(function(L2_f){L2_ops_._html_.on("change",L2_f)})(function(L2_evt){if(L2_evt instanceof L2.Ar)L2_evt=L2_evt.v[0];L2_Ops["_vEnt:"](L2.sca(L2_id(L2.html([L2_evt._event_.currentTarget])._html_.checkElmt())),new L2.Box(L2.sc.split(L2.sca(L2_val(L2.html([L2_evt._event_.currentTarget])._html_.checkElmt())),",")._mapMeth("trim")));L2.sca(L2_updateGridCount())});(function(L2_f){L2.html(document.querySelectorAll("#option_form"))._html_.on("submit",L2_f)})(function(){L2.sca(L2_show(L2_busy_));(function(L2_f){(function(){var cancel=setTimeout(L2.assert.func(L2_f),100);return function(){clearTimeout(cancel)}})()})(function(){L2_circle=false;var L2_geoVal=L2.sca(L2_val(L2.html(document.querySelectorAll("#geo"))));L2_GeoOps=L2.sc.unwrap(L2_AllGeoOps._vEnt(L2_geoVal));if(L2_Data["_barEnt1"]("desc")===L2_geoVal){L2.sca(L2_createGrid())}else{(function(L2_f){L2.aux.ajaxLoad("data/"+L2_geoVal+"/processed-data.L2T",L2_f,"","")})(function(L2_D){if(!(L2_D instanceof L2.Ar))L2_D=new L2.ArJSA([L2_D]);L2_Data=L2_D;L2.sca(L2_createGrid())})}})});(function(L2_f){L2.html(document.querySelectorAll("#circle"))._html_.on("click",L2_f)})(function(){L2_circle=true;L2.sca(L2_plotMain())});var L2_plotSort=function(){L2.sca(L2_clear(L2_plot_main_));var L2_shape=L2.sca(L2_val(L2.html(document.querySelectorAll("#shape"))));L2.html(document.querySelectorAll("#circle"))._html_.setGen(["setStyle","visibility",L2_shape!=="tri-base"&&L2_shape!=="tri-side"?"visible":"hidden"]);var L2_Grid=L2.sc.unwrap(L2_Data._dEnt("grid"));var L2_nMapShown=L2.pf.math["<>"](L2_Grid.r,L2.sca(L2_val(L2.html(document.querySelectorAll("#max")))));L2.tab(L2_Tile._dEnt("cost")(L2_Data,L2.tab(L2_val(L2_par_))["key:"]("r",undefined,L2.tab(L2_id(L2_par_)))._map(L2.pf.ew.num)));var L2_TotalCost=L2.sc.unwrap(L2.sc._dEnt(L2_Data._dEnt("cost"),"totalCost"));L2.html(document.querySelectorAll("#tile_maps_shown"))._html_.setGen(["setProp","innerHTML",L2_nMapShown]);var L2_Top=L2_TotalCost._oneDimSc("c","total")["asc"]("index")["slice"]("r",0,L2_nMapShown-1);L2.sca(L2_clear(L2_plot_cost_));L2.sca(L2_Tile._dEnt("plotCost")(L2_Data,undefined,L2.sc.pair("put",L2_plot_cost_)));var L2_t_index_=0;var L2_t_limit_=L2_Top.v.length;var L2_t=L2_Top.v[0];for(;L2_t_index_<L2_t_limit_;L2_t=L2_Top.v[++L2_t_index_]){L2_plot_main_._html_.adjHTML("beforeend",'<div id="cost_table_'+L2_t+'" data-index="'+L2_t+'" class="panel"></div><br>');var L2_panel=L2.html(document.querySelectorAll("#cost_table_"+L2_t));L2.aux.prt(L2_Grid._twoDim("r","c",new L2.ArJSA([L2_t]),new L2.ArJSA(["noise","displace"])._appendSc("smooth","r")._appendSc("shift","r"))["key:"]("c","displace","transform")._appendAr(new L2.ArJSA([L2_TotalCost._e(L2_t,"total")])["key:"]("c",undefined,"cost"),"c"),undefined,"col",L2_panel);L2.sca(L2_Tile._dEnt("plotTileMap")(L2_Data,new L2.ArCopy(L2_GeoOps,true)._dPush("put",L2_panel),L2.sc.pairMult("ind",L2_t,"circle",L2_circle)))}};var L2_plotMain=function(){L2.sca(L2_plotSort());(function(L2_f){L2.html(document.querySelectorAll(".panel"))._html_.on("click",L2_f)})(function(L2_evt){if(L2_evt instanceof L2.Ar)L2_evt=L2_evt.v[0];L2.sca(L2_show(L2_detail_group_));var L2_mapIndex=L2.html([L2_evt._event_.currentTarget])._html_.checkElmt()._html_.getGen("attr","data-index")._map(L2.pf.ew.num).v[0];var L2_plotDetail=function(){L2.sca(L2_clear(L2_detail_));L2.sca(L2_hide(L2_cost_show_form_));L2.aux.prt(L2.sc.unwrap(L2_Data._dEnt("grid"))._twoDim("r","c",new L2.ArJSA([L2_mapIndex]),new L2.ArJSA(["noise","displace"])._appendSc("smooth","r")._appendSc("shift","r"))["key:"]("c","displace","transform")._appendAr(new L2.ArJSA([L2.sc.unwrap(L2.sc._dEnt(L2_Data._dEnt("cost"),"totalCost"))._e(L2_mapIndex,"total")])["key:"]("c",undefined,"total cost"),"c"),undefined,"col",L2.html(document.querySelectorAll("#detail_option")));var L2_choice=L2.html(document.querySelectorAll('input[name="map_choice"]:checked'))._html_.getGen("attr","value").v[0];var L2_DetailOps=new L2.ArCopy(L2_GeoOps,true)._dPush("put",L2_detail_);if(L2_choice==="orig_map"){L2.sca(L2_Tile._dEnt("plotProcessed")(L2_Data,false,L2_DetailOps))}else if(L2_choice==="adjacency"){L2.sca(L2_Tile._dEnt("plotProcessed")(L2_Data,true,L2_DetailOps))}else if(L2_choice==="displace"){L2.sca(L2_Tile._dEnt("plotDisplace")(L2_Data,L2_mapIndex,L2_DetailOps))}else if(L2_choice==="displace_only"){L2.sca(L2_Tile._dEnt("plotDisplaceOnly")(L2_Data,L2_mapIndex,L2_DetailOps))}else if(L2_choice==="grid"){L2.sca(L2_Tile._dEnt("plotGrid")(L2_Data,L2_mapIndex,L2_DetailOps,true))}else{var L2_plotSpecCost=function(){L2.sca(L2_clear(L2_detail_));var L2_costChoice=L2.html(document.querySelectorAll('input[name="cost_choice"]:checked'))._html_.getGen("attr","value").v[0];L2.sca(L2_Tile._dEnt("plotTileMap")(L2_Data,L2_DetailOps,L2.sc.pairMult("ind",L2_mapIndex,"cost",L2_costChoice,"circle",L2_circle)))};L2.sca(L2_show(L2_cost_show_form_));L2.sca(L2_plotSpecCost());L2_cost_show_form_._html_.off("change")._html_.on("change",L2_plotSpecCost,"costChange")}};L2.html(document.querySelectorAll("#detail_form"))._html_.off("change")._html_.on("change",L2_plotDetail,"detailChange");L2.sca(L2_plotDetail())});L2.html(document.querySelectorAll("#mask, #close_detail"))._html_.on("click",function(){return L2.sca(L2_hide(L2_detail_group_))})};(function(L2_f){L2.html(document.querySelectorAll("#param_form"))._html_.on("submit",L2_f)})(function(){L2_circle=false;L2.sca(L2_plotMain())})})},{"tile.js":5}],2:[function(require,module,exports){(function(){var L2_Grid=L2.sc.pairNone();var L2_Poly=(L2.assert.notBr(),L2.aux.modulePost(require("polygon.js")));var L2_make=function(L2_Mn,L2_Mx,L2_step,L2_tile){if(!(L2_Mn instanceof L2.Ar))L2_Mn=new L2.ArJSA([L2_Mn]);if(!(L2_Mx instanceof L2.Ar))L2_Mx=new L2.ArJSA([L2_Mx]);if(L2_step instanceof L2.Ar)L2_step=L2_step.v[0];if(L2_tile instanceof L2.Ar)L2_tile=L2_tile.v[0];var L2_X=new L2.ArJSA([undefined]);var L2_Y=new L2.ArJSA([undefined]);var L2_G=new L2.ArJSA([undefined]);var L2_Offset=new L2.ArJSA([undefined]);var L2_XVal=new L2.ArJSA([undefined]);var L2_Nx=new L2.ArJSA([undefined]);var L2_StepY=new L2.ArJSA([undefined]);var L2_StepX=new L2.ArJSA([undefined]);var L2_StartX=new L2.ArJSA([undefined]);var L2_ThisX=new L2.ArJSA([undefined]);if(L2_tile==="hex-side"){L2_X=L2.sc.range(L2_Mn.v[+0],L2_Mx.v[+0],L2_step);L2_Y=L2.sc.range(L2_Mn.v[+1],L2_Mx.v[+1],L2.pf.ew.sqrt(3)/2*L2_step);L2_G=L2_X["rep"]("r",L2_Y.r)._appendAr(new L2.ArTp(L2_Y)["rep"]("r",L2_X.r)._v(),"c");L2_Offset=L2.symb.as["%"](new L2.ArTp(L2.sc.range(0,L2_Y.r-1))["rep"]("r",L2_X.r),2)["find"]();L2_G._twoDimSet("r","c",L2_Offset,new L2.ArJSA([0]),L2.symb.as["+"](L2_G._twoDim("r","c",L2_Offset,new L2.ArJSA([0])),L2_step/2));L2_G._oneDimAr("r",L2.symb.as[">"](L2_G._oneDimSc("c",0),L2_Mx.v[+0])["find"](),"cut");return L2_G}else if(L2_tile==="hex-base"){L2_X=L2.sc.range(L2_Mn.v[+0],L2_Mx.v[+0],L2.pf.ew.sqrt(3)*L2_step);L2_Y=L2.sc.range(L2_Mn.v[+1],L2_Mx.v[+1],L2_step/2);L2_G=L2_X["rep"]("r",L2_Y.r)._appendAr(new L2.ArTp(L2_Y)["rep"]("r",L2_X.r)._v(),"c");L2_Offset=L2.symb.as["%"](new L2.ArTp(L2.sc.range(0,L2_Y.r-1))["rep"]("r",L2_X.r),2)["find"]();L2_G._twoDimSet("r","c",L2_Offset,new L2.ArJSA([0]),L2.symb.as["+"](L2_G._twoDim("r","c",L2_Offset,new L2.ArJSA([0])),L2.pf.ew.sqrt(3)/2*L2_step));L2_G._oneDimAr("r",L2.symb.as[">"](L2_G._oneDimSc("c",0),L2_Mx.v[+0])["find"](),"cut");return L2_G}else if(L2_tile==="tri-base"){L2_XVal=new L2.Ar(4);L2_XVal["_vEnt:"](0,new L2.Box(L2.sc.range(L2_Mn.v[+0],L2_Mx.v[+0],L2.pf.ew.sqrt(3)*L2_step)));L2_XVal["_vEnt:"](1,new L2.Box(L2.sc.range(L2_Mn.v[+0]+L2.pf.ew.sqrt(3)/2*L2_step,L2_Mx.v[+0],L2.pf.ew.sqrt(3)*L2_step)));L2_XVal["_vEnt:"](2,L2_XVal._vEnt(1));L2_XVal["_vEnt:"](3,L2_XVal._vEnt(0));L2_Nx=L2_XVal["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A.r});L2_StepY=new L2.ArJSA([L2_step/2,L2_step])._appendSc(L2_step/2,"r")._appendSc(L2_step,"r");var L2_yVal=L2_Mn.v[+1];L2_X=new L2.ArJSA([]);L2_Y=new L2.ArJSA([]);var L2_k=0;while(L2_yVal<=L2_Mx.v[+1]){L2_X._appendAr(L2.sc.unwrap(L2_XVal.v[+L2_k]),"r",false,true);L2_Y._appendAr(new L2.Ar(L2_Nx.v[+L2_k],L2_yVal),"r",false,true);L2_yVal=L2_yVal+L2_StepY.v[+L2_k];L2_k=(L2_k+1)%4}return L2_X._appendAr(L2_Y,"c")}else if(L2_tile==="tri-side"){L2_XVal=new L2.Ar(2);L2_StepX=new L2.ArJSA([2*L2_step,L2_step]);L2_StartX=new L2.ArJSA([L2_Mn.v[+0],L2_Mn.v[+0]+L2_step/2]);for(var L2_st=0;L2_st<=1;L2_st+=1){var L2_last=L2_StartX.v[+L2_st];L2_k=L2.pf.ew.bool(L2_st);L2_ThisX=new L2.ArJSA([]);while(L2_last<=L2_Mx.v[+0]){L2_ThisX._appendSc(L2_last,"r",false,true);L2_last=L2_last+L2_StepX.v[+L2_k];L2_k=!L2_k}L2_XVal["_slashEnt1:"](L2_st,new L2.Box(L2_ThisX))}L2_Nx=L2_XVal["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A.r});var L2_stepY=L2.pf.ew.sqrt(3)/2*L2_step;L2_yVal=L2_Mn.v[+1];L2_X=new L2.ArJSA([]);L2_Y=new L2.ArJSA([]);L2_k=false;while(L2_yVal<=L2_Mx.v[+1]){L2_X._appendAr(L2.sc.unwrap(L2_XVal.v[+L2_k]),"r",false,true);L2_Y._appendAr(new L2.Ar(L2_Nx.v[+L2_k],L2_yVal),"r",false,true);L2_yVal=L2_yVal+L2_stepY;L2_k=!L2_k}return L2_X._appendAr(L2_Y,"c")}else if(L2_tile==="sq"){L2_X=L2.sc.range(L2_Mn.v[+0],L2_Mx.v[+0],L2_step);L2_Y=L2.sc.range(L2_Mn.v[+1],L2_Mx.v[+1],L2_step);return L2_X["rep"]("r",L2_Y.r)._appendAr(new L2.ArTp(L2_Y)["rep"]("r",L2_X.r)._v(),"c")}else{L2.ge.error("invalid tile shape")}};L2_Grid._dPush("make",L2_make);var L2_inPoly=function(L2_nG,L2_P,L2_tile,L2_translate,L2_maxIter){if(L2_nG instanceof L2.Ar)L2_nG=L2_nG.v[0];if(!(L2_P instanceof L2.Ar))L2_P=new L2.ArJSA([L2_P]);if(L2_tile instanceof L2.Ar)L2_tile=L2_tile.v[0];if(L2_translate instanceof L2.Ar)L2_translate=L2_translate.v[0];if(L2_maxIter instanceof L2.Ar)L2_maxIter=L2_maxIter.v[0];var L2_Shift=new L2.ArJSA([undefined]);var L2_G=new L2.ArJSA([undefined]);var L2_In=new L2.ArJSA([undefined]);L2_maxIter=L2_maxIter||50;var L2_step=L2.pf.ew.sqrt(L2.sca(L2_Poly._dEnt("area")(L2_P))/L2_nG);var L2_Mn=L2_P["min"]("r");var L2_Mx=L2_P["max"]("r");if(L2_translate){L2_Shift=L2.symb.as["/"](L2.symb.as["*"](L2.symb.as[">="](L2.sc.apnd("c","x","y")._mapMeth_sa("search",L2.pf.ew.str(L2_translate)),0)._map(L2.pf.ew.num),L2_step),2);L2_P=L2.symb.aa.apply("+",L2_P,L2_Shift["to"](L2_P));L2_Mx=L2.symb.aa.apply("+",L2_Mx,L2_Shift)}var L2_stepMin=undefined;var L2_stepMax=undefined;for(var L2_i=1;L2_i<=L2_maxIter;L2_i+=1){L2_G=L2.tab(L2_make(L2_Mn,L2_Mx,L2_step,L2_tile));L2_In=L2.tab(L2_Poly._dEnt("isIn")(L2_G,L2_P))["find"]();if(L2_In.r<L2_nG){L2_stepMax=L2_step;L2_step=(L2_step+(L2_stepMin||L2_step*.9))/2}else if(L2_In.r>L2_nG){L2_stepMin=L2_step;L2_step=(L2_step+(L2_stepMax||L2_step*1.1))/2}else{if(L2_translate){L2_G=L2.symb.aa.apply("-",L2_G,L2_Shift["to"](L2_G))}return L2.sc.pairMult("step",L2_step,"xy",new L2.Box(L2_G._oneDimAr("r",L2_In)))}}};L2_Grid._dPush("inPoly",L2_inPoly);module.exports=L2_Grid})()},{"polygon.js":4}],3:[function(require,module,exports){(function(){var L2_Munkres=L2.sc.pairNone();var MAX_SIZE=parseInt(Number.MAX_SAFE_INTEGER/2)||(1<<26)*(1<<26);var DEFAULT_PAD_VALUE=0;function Munkres(){this.C=null;this.row_covered=[];this.col_covered=[];this.n=0;this.Z0_r=0;this.Z0_c=0;this.marked=null;this.path=null}Munkres.prototype.pad_matrix=function(matrix,pad_value){pad_value=pad_value||DEFAULT_PAD_VALUE;var max_columns=0;var total_rows=matrix.length;var i;for(i=0;i<total_rows;++i)if(matrix[i].length>max_columns)max_columns=matrix[i].length;total_rows=max_columns>total_rows?max_columns:total_rows;var new_matrix=[];for(i=0;i<total_rows;++i){var row=matrix[i]||[];var new_row=row.slice();while(total_rows>new_row.length)new_row.push(pad_value);new_matrix.push(new_row)}return new_matrix};Munkres.prototype.compute=function(cost_matrix,options){options=options||{};options.padValue=options.padValue||DEFAULT_PAD_VALUE;this.C=this.pad_matrix(cost_matrix,options.padValue);this.n=this.C.length;this.original_length=cost_matrix.length;this.original_width=cost_matrix[0].length;var nfalseArray=[];while(nfalseArray.length<this.n)nfalseArray.push(false);this.row_covered=nfalseArray.slice();this.col_covered=nfalseArray.slice();this.Z0_r=0;this.Z0_c=0;this.path=this.__make_matrix(this.n*2,0);this.marked=this.__make_matrix(this.n,0);var step=1;var steps={1:this.__step1,2:this.__step2,3:this.__step3,4:this.__step4,5:this.__step5,6:this.__step6};while(true){var func=steps[step];if(!func)break;step=func.apply(this)}var results=[];for(var i=0;i<this.original_length;++i)for(var j=0;j<this.original_width;++j)if(this.marked[i][j]==1)results.push([i,j]);return results};Munkres.prototype.__make_matrix=function(n,val){var matrix=[];for(var i=0;i<n;++i){matrix[i]=[];for(var j=0;j<n;++j)matrix[i][j]=val}return matrix};Munkres.prototype.__step1=function(){for(var i=0;i<this.n;++i){var minval=Math.min.apply(Math,this.C[i]);for(var j=0;j<this.n;++j)this.C[i][j]-=minval}return 2};Munkres.prototype.__step2=function(){for(var i=0;i<this.n;++i){for(var j=0;j<this.n;++j){if(this.C[i][j]===0&&!this.col_covered[j]&&!this.row_covered[i]){this.marked[i][j]=1;this.col_covered[j]=true;this.row_covered[i]=true}}}this.__clear_covers();return 3};Munkres.prototype.__step3=function(){var count=0;for(var i=0;i<this.n;++i){for(var j=0;j<this.n;++j){if(this.marked[i][j]==1){this.col_covered[j]=true;++count}}}return count>=this.n?7:4};Munkres.prototype.__step4=function(){var done=false;var row=-1,col=-1,star_col=-1;while(!done){var z=this.__find_a_zero();row=z[0];col=z[1];if(row<0)return 6;this.marked[row][col]=2;star_col=this.__find_star_in_row(row);if(star_col>=0){col=star_col;this.row_covered[row]=true;this.col_covered[col]=false}else{this.Z0_r=row;this.Z0_c=col;return 5}}};Munkres.prototype.__step5=function(){var count=0;this.path[count][0]=this.Z0_r;this.path[count][1]=this.Z0_c;var done=false;while(!done){var row=this.__find_star_in_col(this.path[count][1]);if(row>=0){count++;this.path[count][0]=row;this.path[count][1]=this.path[count-1][1]}else{done=true}if(!done){var col=this.__find_prime_in_row(this.path[count][0]);count++;this.path[count][0]=this.path[count-1][0];this.path[count][1]=col}}this.__convert_path(this.path,count);this.__clear_covers();this.__erase_primes();return 3};Munkres.prototype.__step6=function(){var minval=this.__find_smallest();for(var i=0;i<this.n;++i){for(var j=0;j<this.n;++j){if(this.row_covered[i])this.C[i][j]+=minval;if(!this.col_covered[j])this.C[i][j]-=minval}}return 4};Munkres.prototype.__find_smallest=function(){var minval=MAX_SIZE;for(var i=0;i<this.n;++i)for(var j=0;j<this.n;++j)if(!this.row_covered[i]&&!this.col_covered[j])if(minval>this.C[i][j])minval=this.C[i][j];return minval};Munkres.prototype.__find_a_zero=function(){for(var i=0;i<this.n;++i)for(var j=0;j<this.n;++j)if(this.C[i][j]===0&&!this.row_covered[i]&&!this.col_covered[j])return[i,j];return[-1,-1]};Munkres.prototype.__find_star_in_row=function(row){for(var j=0;j<this.n;++j)if(this.marked[row][j]==1)return j;return-1};Munkres.prototype.__find_star_in_col=function(col){for(var i=0;i<this.n;++i)if(this.marked[i][col]==1)return i;return-1};Munkres.prototype.__find_prime_in_row=function(row){for(var j=0;j<this.n;++j)if(this.marked[row][j]==2)return j;return-1};Munkres.prototype.__convert_path=function(path,count){for(var i=0;i<=count;++i)this.marked[path[i][0]][path[i][1]]=this.marked[path[i][0]][path[i][1]]==1?0:1};Munkres.prototype.__clear_covers=function(){for(var i=0;i<this.n;++i){this.row_covered[i]=false;this.col_covered[i]=false}};Munkres.prototype.__erase_primes=function(){for(var i=0;i<this.n;++i)for(var j=0;j<this.n;++j)if(this.marked[i][j]==2)this.marked[i][j]=0};function make_cost_matrix(profit_matrix,inversion_function){var i,j;if(!inversion_function){var maximum=-1/0;for(i=0;i<profit_matrix.length;++i)for(j=0;j<profit_matrix[i].length;++j)if(profit_matrix[i][j]>maximum)maximum=profit_matrix[i][j];inversion_function=function(x){return maximum-x}}var cost_matrix=[];for(i=0;i<profit_matrix.length;++i){var row=profit_matrix[i];cost_matrix[i]=[];for(j=0;j<row.length;++j)cost_matrix[i][j]=inversion_function(profit_matrix[i][j])}return cost_matrix}function format_matrix(matrix){function log10(v){if(Math.log10)return Math.log10(v);return Math.log(v)/Math.log(10)}var columnWidths=[];var i,j;for(i=0;i<matrix.length;++i){for(j=0;j<matrix[i].length;++j){var entryWidth=String(matrix[i][j]).length;if(!columnWidths[j]||entryWidth>=columnWidths[j])columnWidths[j]=entryWidth}}var formatted="";for(i=0;i<matrix.length;++i){for(j=0;j<matrix[i].length;++j){var s=String(matrix[i][j]);while(s.length<columnWidths[j])s=" "+s;formatted+=s;if(j!=matrix[i].length-1)formatted+=" "}if(i!=matrix[i].length-1)formatted+="\n"}return formatted}(function(L2_f){L2_Munkres._dPush("compute",L2_f)})(function(L2_C){if(!(L2_C instanceof L2.Ar))L2_C=new L2.ArJSA([L2_C]);if(!L2.ge.isMat(L2_C)||L2_C.r!==L2_C.c){L2.ge.error("square matrix expected")}undefined;return L2.linAlg.unmatrix([(new Munkres).compute(L2.linAlg.matrix(L2_C)[0])])});module.exports=L2_Munkres})()},{}],4:[function(require,module,exports){(function(){var L2_Poly=L2.sc.pairNone();var L2_area=function(L2_P){if(!(L2_P instanceof L2.Ar))L2_P=new L2.ArJSA([L2_P]);var L2_X=L2_P._oneDimSc("c",0);var L2_Y=L2_P._oneDimSc("c",1);return L2.symb.as["/"](L2.symb.aa.apply("-",L2.symb.aa.apply("*",L2_X["slice"]("r",0,-2),L2_Y["slice"]("r",1,-1)),L2.symb.aa.apply("*",L2_X["slice"]("r",1,-1),L2_Y["slice"]("r",0,-2)))["sum"]("r"),2)._map(L2.pf.ew.abs)};L2_Poly._dPush("area",L2_area);var L2_arcLen=function(L2_P){if(!(L2_P instanceof L2.Ar))L2_P=new L2.ArJSA([L2_P]);return L2.symb.aa.apply("-",L2_P["slice"]("r",1,-1),L2_P["slice"]("r",0,-2))._map_1_as(L2.pf.math["^"],2)["sum"]("c")._appendSc(0,"r",true)._map(L2.pf.ew.sqrt)["cuSum"]("r")};L2_Poly._dPush("arcLen",L2_arcLen);var L2_eqSpace=function(L2_P,L2_k){if(!(L2_P instanceof L2.Ar))L2_P=new L2.ArJSA([L2_P]);if(L2_k instanceof L2.Ar)L2_k=L2_k.v[0];if(L2_P.r<2||L2_k<2){L2.ge.error("original and resampled polygon must have more than 2 points")}var L2_ArcP=L2.tab(L2_arcLen(L2_P));var L2_DiffP=L2.symb.aa.apply("-",L2_ArcP["slice"]("r",1,-1),L2_ArcP["slice"]("r",0,-2))._appendSc(0,"r",true);var L2_step=L2_ArcP._vEnt(-1)/L2_k;var L2_ArcK=L2.sc.range(0,L2_ArcP._vEnt(-1),L2_step)["slice"]("r",0,L2_k-1);var L2_NewP=new L2.ArSh(new L2.ArJSA([L2_k,2]));var L2_next=1;for(var L2_i=0;L2_i<=L2_k-1;L2_i+=1){while(1){if(L2_ArcK._vEnt(L2_i)<=L2_ArcP._vEnt(L2_next)){var L2_interp=(L2_ArcK._vEnt(L2_i)-L2_ArcP._vEnt(L2_next-1))/L2_DiffP._vEnt(L2_next);L2_NewP._oneDimSetAr("r",new L2.ArJSA([L2_i]),L2.symb.aa.apply("+",L2.symb.as["*"](L2_P._oneDimSc("r",L2_next-1),1-L2_interp),L2.symb.as["*"](L2_P._oneDimSc("r",L2_next),L2_interp)));break}L2_next=L2_next+1}}return L2_NewP};L2_Poly._dPush("eqSpace",L2_eqSpace);var L2_isIn=function(L2_TestXY,L2_VertXY){if(!(L2_TestXY instanceof L2.Ar))L2_TestXY=new L2.ArJSA([L2_TestXY]);if(!(L2_VertXY instanceof L2.Ar))L2_VertXY=new L2.ArJSA([L2_VertXY]);var T,V,nT,nV,In,i,j,k,x,y,xi,yi,xj,yj,inside;T=L2.linAlg.matrix(L2_TestXY)[0];V=L2.linAlg.matrix(L2_VertXY)[0];nT=T.length;nV=V.length;In=new Array(nT);for(k=0;k<nT;k++){x=T[k][0];y=T[k][1];inside=false;j=nV-1;for(i=0;i<nV;i++){xi=V[i][0];yi=V[i][1];xj=V[j][0];yj=V[j][1];if(yi>y!==yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi)inside=!inside;j=i}In[k]=inside}return new L2.ArJSA(In);undefined};L2_Poly._dPush("isIn",L2_isIn);var L2_fromGeoJSON=function(L2_X,L2_name){if(!(L2_X instanceof L2.Ar))L2_X=new L2.ArJSA([L2_X]);if(L2_name instanceof L2.Ar)L2_name=L2_name.v[0];var L2_Tmp=new L2.ArJSA([undefined]);L2_X=L2.sc.unwrap(L2_X._dEnt("features"));var L2_R=new L2.ArSh(new L2.ArJSA([0,2]))["key:"]("c",undefined,new L2.ArJSA(["name","polygon"]));var L2_ent_index_=0;var L2_ent_limit_=L2_X.v.length;var L2_ent=L2_X.v[0];for(;L2_ent_index_<L2_ent_limit_;L2_ent=L2_X.v[++L2_ent_index_]){var L2_rg=L2.aux.openIfBox(L2.sc._dEnt(L2_ent,"properties"))._vEnt(L2_name);if(L2.sc._dEnt(L2.sc._dEnt(L2_ent,"geometry"),"type")==="Polygon"){L2_R._appendAr(L2.sc.apnd("c",L2_rg,new L2.Box(L2.sc.unwrap(L2.sc.unwrap(L2.sc._dEnt(L2.sc._dEnt(L2_ent,"geometry"),"coordinates")).v[0])["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return new L2.ArTp(L2_A)})["unwrap"]("c"))),"r",false,true)}else if(L2.sc._dEnt(L2.sc._dEnt(L2_ent,"geometry"),"type")==="MultiPolygon"){L2_Tmp=L2.sc.unwrap(L2.sc._dEnt(L2.sc._dEnt(L2_ent,"geometry"),"coordinates"))["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.sc.unwrap(L2_A.v[0])["map"](function(L2_B){if(!(L2_B instanceof L2.Ar))L2_B=new L2.ArJSA([L2_B]);return new L2.ArTp(L2_B)})["unwrap"]("c")});L2_R._appendAr(new L2.ArJSA([L2_rg])["rep"]("r",L2_Tmp.r)._appendAr(L2_Tmp,"c"),"r",false,true)}else{"geometry type must be Polygon or MuliPolygon"}}return L2_R["order"](new L2.ArJSA([0]))};L2_Poly._dPush("fromGeoJSON",L2_fromGeoJSON);var L2_circDist=function(L2_A,L2_B,L2_mx){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);if(!(L2_B instanceof L2.Ar))L2_B=new L2.ArJSA([L2_B]);if(L2_mx instanceof L2.Ar)L2_mx=L2_mx.v[0];var L2_AbsDiff=L2.symb.aa.apply("-",L2_A,L2_B)._map(L2.pf.ew.abs);return L2.symb.sa["-"](L2_mx,L2_AbsDiff)._map_1_aa(L2.pf.math["<>"],L2_AbsDiff)};L2_Poly._dPush("circDist",L2_circDist);var L2_smooth=function(L2_P,L2_k,L2_basis){if(!(L2_P instanceof L2.Ar))L2_P=new L2.ArJSA([L2_P]);if(L2_k instanceof L2.Ar)L2_k=L2_k.v[0];if(L2_basis instanceof L2.Ar)L2_basis=L2_basis.v[0];var L2_Q=new L2.ArJSA([undefined]);var L2_Mu=new L2.ArJSA([undefined]);var L2_Shift=L2_P["mean"]("r");L2_P=L2.symb.aa.apply("-",L2_P,L2_Shift["to"](L2_P));var L2_T=L2.symb.aa.apply("-",L2_P["slice"]("r",1,-1),L2_P["slice"]("r",0,-2))._map_1_as(L2.pf.math["^"],2)["sum"]("c")._map(L2.pf.ew.sqrt)._appendSc(0,"r",true);L2_T=L2_T["cuSum"]("r");if(L2_basis==="trig"){L2_T=L2.symb.as["*"](L2.symb.as["/"](L2_T,L2_T._vEnt(-1)),Math.PI);L2_Q=L2.symb.aa.apply("*",L2_T["rep"]("c",L2_k),new L2.ArTp(L2.sc.range(1,L2_k))["rep"]("r",L2_T.r));L2_Q=L2_Q._map(L2.pf.ew.sin)._appendAr(L2_Q._map(L2.pf.ew.cos),"c");L2_k=2*L2_k}else if(L2_basis==="rbf"){var L2_maxT=L2_T._vEnt(-1);L2_Mu=L2.sc.range(0,L2_maxT*.9999,L2_maxT/L2_k);L2_Q=L2.symb.as["/"](L2.tab(L2_circDist(L2_T["rep"]("c",L2_Mu.r),new L2.ArTp(L2_Mu)["rep"]("r",L2_T.r),L2_maxT))._map_1_as(L2.pf.math["^"],2),L2.pf.math["^"](L2_maxT/L2_k,2)*2)._unary()._map(L2.pf.ew.exp)}else{L2.ge.error("invalid choice of basis function")}var L2_Beta=L2.symb.aa.apply("+",new L2.ArTp(L2_Q)["mm"](L2_Q),L2.symb.as["*"](L2.linAlg.eye(L2_k),1e-10))["inv"]()["mm"](new L2.ArTp(L2_Q))["mm"](L2_P);return L2.symb.aa.apply("+",L2_Q["mm"](L2_Beta),L2_Shift["to"](L2_P))};L2_Poly._dPush("smooth",L2_smooth);module.exports=L2_Poly})()},{}],5:[function(require,module,exports){(function(){var L2_Tile=L2.sc.pairNone();var L2_munkres=(L2.assert.notBr(),L2.aux.modulePost(require("munkres.js"))).v[0];var L2_Poly=(L2.assert.notBr(),L2.aux.modulePost(require("polygon.js")));var L2_GridFuncs=(L2.assert.notBr(),L2.aux.modulePost(require("grid.js")));var L2_angleMat=function(L2_U,L2_V){if(!(L2_U instanceof L2.Ar))L2_U=new L2.ArJSA([L2_U]);if(!(L2_V instanceof L2.Ar))L2_V=new L2.ArJSA([L2_V]);if(arguments.length<2){L2_V=L2_U}var L2_D=new L2.ArSh(new L2.ArJSA([L2_U.r,L2_V.r]));var L2_i=0;var L2_i_limit_=L2_U.r;for(;L2_i<L2_i_limit_;L2_i++){var L2_tmpX=L2_U._slashEnt2(L2_i,0);var L2_tmpY=L2_U._slashEnt2(L2_i,1);var L2_j=0;var L2_j_limit_=L2_V.r;for(;L2_j<L2_j_limit_;L2_j++){L2_D["_slashEnt2:"](L2_i,L2_j,L2.pf.ew.num(L2_V._slashEnt2(L2_j,0)-L2_tmpX).angle(L2_V._slashEnt2(L2_j,1)-L2_tmpY))}}return L2_D};L2_Tile._dPush("angleMat",L2_angleMat);var L2_angleDiff=function(L2_U,L2_V){if(!(L2_U instanceof L2.Ar))L2_U=new L2.ArJSA([L2_U]);if(!(L2_V instanceof L2.Ar))L2_V=new L2.ArJSA([L2_V]);var L2_D=L2.symb.aa.apply("-",L2_U,L2_V)._map(L2.pf.ew.abs);return L2.symb.sa["-"](2*Math.PI,L2_D)._map_1_aa(L2.pf.math["<>"],L2_D)};L2_Tile._dPush("angleDiff",L2_angleDiff);var L2_unitLen=function(L2_X,L2_d){if(!(L2_X instanceof L2.Ar))L2_X=new L2.ArJSA([L2_X]);if(L2_d instanceof L2.Ar)L2_d=L2_d.v[0];return L2.symb.aa.apply("/",L2_X,L2_X._map_1_as(L2.pf.math["^"],2)["sum"](L2.aux.validSfx(L2_d,true))._map(L2.pf.ew.sqrt)["rep"](L2.aux.validSfx(L2_d,false),L2_X._n(L2_d)))};var L2_multiToPoly=function(L2_G){if(!(L2_G instanceof L2.Ar))L2_G=new L2.ArJSA([L2_G]);var L2_F=L2.sc.unwrap(L2_G._dEnt("features"));var L2_MultiInd=L2.symb.as["=="](L2_F["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.sc._dEnt(L2_A._dEnt("geometry"),"type")})._map(L2.pf.ew.unbox),"MultiPolygon")["find"]();var L2_i_index_=0;var L2_i_limit_=L2_MultiInd.v.length;var L2_i=L2_MultiInd.v[0];for(;L2_i_index_<L2_i_limit_;L2_i=L2_MultiInd.v[++L2_i_index_]){var L2_mostVertInd=L2.sc.unwrap(L2.sc._dEnt(L2.sc._dEnt(L2_F.v[+L2_i],"geometry"),"coordinates"))["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A.r})["max"]("r","index").v[0];L2.sc._dPush(L2_F.v[+L2_i],"geometry",new L2.Box(L2.sc.pairMult("type","Polygon","coordinates",L2.sc.unwrap(L2.sc._dEnt(L2.sc._dEnt(L2_F.v[+L2_i],"geometry"),"coordinates")).v[+L2_mostVertInd])))}return L2_G};L2_Tile._dPush("multiToPoly",L2_multiToPoly);var L2_combinePoly=function(L2_G,L2_name){if(!(L2_G instanceof L2.Ar))L2_G=new L2.ArJSA([L2_G]);if(L2_name instanceof L2.Ar)L2_name=L2_name.v[0];var L2_Ind=new L2.ArJSA([undefined]);var L2_R=new L2.ArJSA([undefined]);var L2_Typ=new L2.ArJSA([undefined]);var L2_Poly=new L2.ArJSA([undefined]);var L2_F=L2.sc.unwrap(L2_G._dEnt("features"));var L2_Mult=L2_F["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.aux.openIfBox(L2_A._dEnt("properties"))._vEnt(L2_name)})["freq"]()["where"]("frequency",function(L2_a){if(L2_a instanceof L2.Ar)L2_a=L2_a.v[0];return L2_a!==1});if(L2.symb.as[">"](L2_Mult._oneDimSc("c","frequency"),2)["any"]("r").v[0]){L2.ge.error("name appears more than twice - write code to handle this!")}var L2_i=0;var L2_i_limit_=L2_Mult.r;for(;L2_i<L2_i_limit_;L2_i++){L2_Ind=L2_F["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.aux.openIfBox(L2_A._dEnt("properties"))._vEnt(L2_name)===L2_Mult._e(L2_i,"value")})["find"]();L2_R=L2_F._oneDimAr("r",L2_Ind);L2_Typ=L2_R["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.sc._dEnt(L2_A._dEnt("geometry"),"type")});L2_Poly=L2_R["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.sc._dEnt(L2_A._dEnt("geometry"),"coordinates")});if(L2.symb.as["=="](L2_Typ,"Polygon")["all"]("r").v[0]){L2.sc._dPush(L2_F._vEnt(L2_Ind._vEnt(0)),"geometry",new L2.Box(L2.sc.pairMult("type","MultiPolygon","coordinates",new L2.Box(L2_Poly))))}else if(L2.ge.equal(L2_Typ["asc"](),new L2.ArJSA(["MultiPolygon","Polygon"]))){if(L2_Typ._vEnt(0)==="Polygon"){L2_Poly=L2_Poly["flip"]("r");L2_Ind=L2_Ind["flip"]("r")}L2.sc._dPush(L2_F._vEnt(L2_Ind._vEnt(0)),"geometry",new L2.Box(L2.sc.pairMult("type","MultiPolygon","coordinates",new L2.Box(L2.sc.unwrap(L2_Poly._vEnt(0))._appendSc(L2_Poly._vEnt(1),"r")))))}else{L2.ge.error("can only handle two polygons or\n or one polygon and one multipolygon")}L2_F._oneDimSc("r",L2_Ind._vEnt(1),"cut")}};L2_Tile._dPush("combinePoly",L2_combinePoly);var L2_rank=function(L2_X){if(!(L2_X instanceof L2.Ar))L2_X=new L2.ArJSA([L2_X]);var L2_C=new L2.ArJSA([undefined]);var L2_Asc=new L2.ArJSA([undefined]);var L2_R=L2_X._shell();var L2_RK=L2_R["key"]("r");var L2_i=0;var L2_i_limit_=L2_X.c;for(;L2_i<L2_i_limit_;L2_i++){L2_C=L2_X._oneDimSc("c",L2_i);L2_Asc=L2_RK._oneDimAr("r",L2_C["asc"]("index"));L2_R._oneDimSetAr("c",new L2.ArJSA([L2_i]),L2_Asc["ind"]("r")["key:"]("r",undefined,L2_Asc)._oneDimAr("r",L2_RK))}return L2_R};L2_Tile._dPush("rank",L2_rank);var L2_sqDistMat=function(L2_U,L2_V){if(!(L2_U instanceof L2.Ar))L2_U=new L2.ArJSA([L2_U]);if(!(L2_V instanceof L2.Ar))L2_V=new L2.ArJSA([L2_V]);if(arguments.length<2){L2_V=L2_U}var L2_D=new L2.ArSh(new L2.ArJSA([L2_U.r,L2_V.r]));var L2_i=0;var L2_i_limit_=L2_U.r;for(;L2_i<L2_i_limit_;L2_i++){var L2_tmpX=L2_U._slashEnt2(L2_i,0);var L2_tmpY=L2_U._slashEnt2(L2_i,1);var L2_j=0;var L2_j_limit_=L2_V.r;for(;L2_j<L2_j_limit_;L2_j++){L2_D["_slashEnt2:"](L2_i,L2_j,L2.pf.math["^"](L2_tmpX-L2_V._slashEnt2(L2_j,0),2)+L2.pf.math["^"](L2_tmpY-L2_V._slashEnt2(L2_j,1),2))}}return L2_D};L2_Tile._dPush("sqDistMat",L2_sqDistMat);var L2_absDiffMat=function(L2_U,L2_V){if(!(L2_U instanceof L2.Ar))L2_U=new L2.ArJSA([L2_U]);if(!(L2_V instanceof L2.Ar))L2_V=new L2.ArJSA([L2_V]);var L2_D=new L2.ArSh(new L2.ArJSA([L2_U.r,L2_V.r]));var L2_i=0;var L2_i_limit_=L2_U.r;for(;L2_i<L2_i_limit_;L2_i++){var L2_tmpU=L2_U.v[+L2_i];var L2_j=0;var L2_j_limit_=L2_V.r;for(;L2_j<L2_j_limit_;L2_j++){L2_D["_slashEnt2:"](L2_i,L2_j,L2.pf.ew.abs(L2_tmpU-L2_V.v[+L2_j]))}}return L2_D};L2_Tile._dPush("absDiffMat",L2_absDiffMat);var L2_fmtName=function(L2_Name,L2_char){if(!(L2_Name instanceof L2.Ar))L2_Name=new L2.ArJSA([L2_Name]);if(L2_char instanceof L2.Ar)L2_char=L2_char.v[0];var L2_Fmtd=L2_Name._mapMeth_ass("replaceStr",/^The /,"")._mapMeth_ass("replaceStr",/^North /,"N ")._mapMeth_ass("replaceStr",/^South /,"S ")._mapMeth_ass("replaceStr",/^East /,"E ")._mapMeth_ass("replaceStr",/^West /,"W ")._mapMeth_ass("replaceStr",/^District /,"Dist ")._mapMeth_ass("replaceStr",/^Republic /,"Rep ")._mapMeth_ass("replaceStr",/^Democratic /,"Dem ")._mapMeth_ass("replaceStr",/ Republic(?=$| )/," Rep")._mapMeth_ass("replaceStr",/ Democratic(?=$| )/," Dem")._mapMeth_ass("replaceStr",/ (of|the) /i," ")._mapMeth_ass("replaceStr",/Charente/,"Char")._mapMeth_ass("replaceStr",/Pyrénées/,"Py")._mapMeth_ass("replaceStr",/(Haute?s?)\-/,"H-")._mapMeth_ass("replaceStr",/Santa /,"Sa ")._mapMeth_ass("substr",0,L2_char);if(!L2_Fmtd["isUnique"]()){L2.ge.error("formatted names are not unique")}return L2_Fmtd};L2_Tile._dPush("fmtName",L2_fmtName);var L2_procGeojson=function(L2_path,L2_geo,L2_bound,L2_nameField,L2_Ops){if(L2_path instanceof L2.Ar)L2_path=L2_path.v[0];if(L2_geo instanceof L2.Ar)L2_geo=L2_geo.v[0];if(L2_bound instanceof L2.Ar)L2_bound=L2_bound.v[0];if(L2_nameField instanceof L2.Ar)L2_nameField=L2_nameField.v[0];if(!(L2_Ops instanceof L2.Ar))L2_Ops=new L2.ArJSA([L2_Ops]);var L2_Coord=new L2.ArJSA([undefined]);var L2_P=new L2.ArJSA([undefined]);var L2_EqP=new L2.ArJSA([undefined]);var L2_TmpPoly=new L2.ArJSA([undefined]);var L2_TmpMin=new L2.ArJSA([undefined]);var L2_TmpMax=new L2.ArJSA([undefined]);var L2_Contain=new L2.ArJSA([undefined]);var L2_Par=L2.sc.pairNone();L2_Par._dPush("contain",undefined);L2_Par._dPush("char",undefined);L2_Par._dPush("desc",undefined);L2_Par._dPush("boundaryEq",300);L2_Par["use:"]("r",L2_Ops);var L2_X=L2.sc.unwrap(L2.aux.fromJSON(L2.sc.read(L2_path+L2_geo))._dEnt("features"));var L2_Region=L2_X["map"](function(L2_Y){if(!(L2_Y instanceof L2.Ar))L2_Y=new L2.ArJSA([L2_Y]);return L2.aux.openIfBox(L2_Y._dEnt("properties"))._vEnt(L2_nameField)})._map(L2.pf.ew.unbox);var L2_FmtRegion=L2.tab(L2_Tile._dEnt("fmtName")(L2_Region,L2_Par._dEnt("char")));var L2_nR=L2_Region.r;var L2_Vert=new L2.ArSh(new L2.ArJSA([L2_nR,1]))["key:"]("r",undefined,L2_Region);var L2_VertList=new L2.ArJSA([]);var L2_Cent=new L2.ArSh(new L2.ArJSA([L2_nR,2]))["key:"]("r",undefined,L2_Region);var L2_BBox=new L2.ArSh(new L2.ArJSA([L2_nR,2]))["key:"]("r",undefined,L2_Region);var L2_BBoxCent=new L2.ArSh(new L2.ArJSA([L2_nR,2]))["key:"]("r",undefined,L2_Region);var L2_polyUnnest=function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);var L2_Ret=new L2.ArSh(new L2.ArJSA([L2_A.r,2]));var L2_i=0;var L2_i_limit_=L2_A.r;for(;L2_i<L2_i_limit_;L2_i++){L2_Ret["_slashEnt2:"](L2_i,0,L2.aux.openIfBox(L2_A.v[+L2_i]).v[+0]);L2_Ret["_slashEnt2:"](L2_i,1,L2.aux.openIfBox(L2_A.v[+L2_i]).v[+1])}return L2_Ret};var L2_reg_index_=0;var L2_reg_limit_=L2_Region.v.length;var L2_reg=L2_Region.v[0];for(;L2_reg_index_<L2_reg_limit_;L2_reg=L2_Region.v[++L2_reg_index_]){L2_Coord=L2.sc.unwrap(L2.sc._dEnt(L2.sc.unwrap(L2_X._vEnt(L2_reg_index_))._dEnt("geometry"),"coordinates"));var L2_polyType=L2.sc._dEnt(L2.sc.unwrap(L2_X._vEnt(L2_reg_index_))._dEnt("geometry"),"type");if(L2_polyType==="Polygon"){L2_P=L2.tab(L2_polyUnnest(L2.sc.unwrap(L2_Coord.v[0])));L2_VertList._appendSc(new L2.Box(L2_P),"r",false,true);L2_EqP=L2.tab(L2_Poly._dEnt("eqSpace")(L2_P,L2_P.r))}else if(L2_polyType==="MultiPolygon"){L2_P=new L2.ArSh(new L2.ArJSA([0,2]));L2_EqP=new L2.ArSh(new L2.ArJSA([0,2]));var L2_j=0;var L2_j_limit_=L2_Coord.r;for(;L2_j<L2_j_limit_;L2_j++){L2_TmpPoly=L2.tab(L2_polyUnnest(L2.sc.unwrap(L2.sc.unwrap(L2_Coord._vEnt(L2_j)).v[0])));L2_P._appendAr(L2_TmpPoly,"r",false,true);L2_VertList._appendSc(new L2.Box(L2_TmpPoly),"r",false,true);L2_EqP._appendAr(L2.tab(L2_Poly._dEnt("eqSpace")(L2_TmpPoly,L2_TmpPoly.r)),"r",false,true)}}else{L2.ge.error("Polygon or MultiPolygon expected")}L2_Vert["_barEnt1:"](L2_reg,new L2.Box(L2_P));L2_Cent._oneDimSetAr("r",new L2.ArJSA([L2_reg]),L2_EqP["mean"]("r"));L2_TmpMin=L2_P["min"]("r");L2_TmpMax=L2_P["max"]("r");L2_BBox._oneDimSetAr("r",new L2.ArJSA([L2_reg]),L2.symb.aa.apply("-",L2_TmpMax,L2_TmpMin));L2_BBoxCent._oneDimSetAr("r",new L2.ArJSA([L2_reg]),L2.symb.as["/"](L2.symb.aa.apply("+",L2_TmpMin,L2_TmpMax),2))}var L2_Angle=L2.tab(L2_angleMat(L2_Cent,L2_Cent))["key:"]("r",undefined,L2_Region)["key:"]("c",undefined,L2_Region);var L2_tol=L2.symb.as["/"](L2_BBox["mean"]("e"),200).v[0];var L2_Adj=new L2.ArSh(new L2.ArJSA([L2_nR,L2_nR]),0)["key:"]("r",undefined,L2_Region)["key:"]("c",undefined,L2_Region);var L2_isAdj=function(L2_P1,L2_P2){if(!(L2_P1 instanceof L2.Ar))L2_P1=new L2.ArJSA([L2_P1]);if(!(L2_P2 instanceof L2.Ar))L2_P2=new L2.ArJSA([L2_P2]);var L2_i=0;var L2_i_limit_=L2_P1.r;for(;L2_i<L2_i_limit_;L2_i++){var L2_j=0;var L2_j_limit_=L2_P2.r;for(;L2_j<L2_j_limit_;L2_j++){if(L2.pf.ew.sqrt(L2.pf.math["^"](L2_P1._slashEnt2(L2_i,0)-L2_P2._slashEnt2(L2_j,0),2)+L2.pf.math["^"](L2_P1._slashEnt2(L2_i,1)-L2_P2._slashEnt2(L2_j,1),2))<L2_tol){return true}}}};for(var L2_r1=0;L2_r1<=L2_nR-2;L2_r1+=1){for(var L2_r2=L2_r1+1;L2_r2<=L2_nR-1;L2_r2+=1){if(L2.symb.as["<"](L2.symb.aa.apply("-",L2.symb.aa.apply("-",L2_BBoxCent._oneDimSc("r",L2_r1),L2_BBoxCent._oneDimSc("r",L2_r2))._map(L2.pf.ew.abs),L2.symb.as["/"](L2_BBox._oneDimAr("r",new L2.ArJSA([L2_r1,L2_r2])),2)["sum"]("r")),L2_tol)["all"]("e").v[0]&&L2.sca(L2_isAdj(L2.sc.unwrap(L2_Vert.v[+L2_r1]),L2.sc.unwrap(L2_Vert.v[+L2_r2])))){L2_Adj["_slashEnt2:"](L2_r1,L2_r2,1)}}}if(L2_Par._dEnt("contain")){L2_Contain=L2.sc.unwrap(L2_Par._dEnt("contain"));var L2_i=0;var L2_i_limit_=L2_Contain.r;for(;L2_i<L2_i_limit_;L2_i++){L2_Adj["_e:"](L2_Contain._e(L2_i,0),L2_Contain._e(L2_i,1),1)}}L2_Adj=L2.symb.aa.apply("+",new L2.ArTp(L2_Adj),L2_Adj);var L2_RegNeighb=L2_Adj["wrap"]("c")["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_Region._oneDimAr("r",L2_A["find"]())});var L2_Boundary=L2.sc.unwrap(L2.sc.unwrap(L2.aux.fromJSON(L2.sc.read(L2_path+L2_bound))._dEnt("geometries")).v[0]);if(L2_Boundary._dEnt("type")==="MultiPolygon"){var L2_largestInd=L2.sc.unwrap(L2_Boundary._dEnt("coordinates"))["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.sc.unwrap(L2_A.v[0]).r})["max"]("r","index").v[0];L2_Boundary=L2.sc.unwrap(L2.sc.unwrap(L2.aux.openIfBox(L2_Boundary._dEnt("coordinates")).v[+L2_largestInd]).v[0])}else{L2_largestInd=L2.sc.unwrap(L2_Boundary._dEnt("coordinates"))["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A.r})["max"]("r","index").v[0];L2_Boundary=L2.sc.unwrap(L2.aux.openIfBox(L2_Boundary._dEnt("coordinates")).v[+L2_largestInd])}L2_Boundary=L2_Boundary["map"](function(L2_a){if(L2_a instanceof L2.Ar)L2_a=L2_a.v[0];return L2_a})._appendAr(L2_Boundary["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A.v[+1]}),"c")._map(L2.pf.ew.unbox);var L2_BoundaryEq=L2.tab(L2_Poly._dEnt("eqSpace")(L2_Boundary,L2_Par._dEnt("boundaryEq")));var L2_D=L2.sc.pairNone();L2_D._dPush("desc",L2_Par._dEnt("desc"));L2_D._dPush("cent",new L2.Box(L2_Cent));L2_D._dPush("angle",new L2.Box(L2_Angle));L2_D._dPush("poly",new L2.Box(L2_Vert));L2_D._dPush("polyList",new L2.Box(L2_VertList));L2_D._dPush("adj",new L2.Box(L2_Adj));L2_D._dPush("region",new L2.Box(L2_Region));L2_D._dPush("fmtRegion",new L2.Box(L2_FmtRegion));L2_D._dPush("nR",L2_nR);L2_D._dPush("regNeighb",new L2.Box(L2_RegNeighb));L2_D._dPush("boundary",new L2.Box(L2_Boundary));L2_D._dPush("boundaryEq",new L2.Box(L2_BoundaryEq));L2_D["save"](L2_path+"processed-data.L2T");new L2.ArCopy(L2_Cent,false)["saveCSV"](L2_path+"cent.csv");return L2_D};L2_Tile._dPush("procGeojson",L2_procGeojson);var L2_tileMap=function(L2_D,L2_Ops){if(!(L2_D instanceof L2.Ar))L2_D=new L2.ArJSA([L2_D]);if(!(L2_Ops instanceof L2.Ar))L2_Ops=new L2.ArJSA([L2_Ops]);var L2_Cent=new L2.ArJSA([undefined]);var L2_SqDistCB=new L2.ArJSA([undefined]);var L2_DispVecs=new L2.ArJSA([undefined]);var L2_DispVecsNeighb=new L2.ArJSA([undefined]);var L2_Old=new L2.ArJSA([undefined]);var L2_DispVecsNonAll=new L2.ArJSA([undefined]);var L2_DispVecsNonKey=new L2.ArJSA([undefined]);var L2_New=new L2.ArJSA([undefined]);var L2_TmpDist=new L2.ArJSA([undefined]);var L2_DispCent=new L2.ArJSA([undefined]);var L2_K=new L2.ArJSA([undefined]);var L2_NewCent=new L2.ArJSA([undefined]);var L2_InterpBoundary=new L2.ArJSA([undefined]);var L2_NewBoundary=new L2.ArJSA([undefined]);var L2_NewGrid=new L2.ArJSA([undefined]);var L2_DistWrap=new L2.ArJSA([undefined]);var L2_NewNeighbImmed=new L2.ArJSA([undefined]);var L2_NewNeighb=new L2.ArJSA([undefined]);var L2_SqDist=new L2.ArJSA([undefined]);var L2_Hungarian=new L2.ArJSA([undefined]);var L2_Assign=new L2.ArJSA([undefined]);var L2_InvAssign=new L2.ArJSA([undefined]);var L2_RegCost=new L2.ArJSA([undefined]);var L2_NewAngle=new L2.ArJSA([undefined]);var L2_Par=L2.sc.pairNone();L2_Par._dPush("tile","sq");L2_Par._dPush("displaceStep",30);L2_Par._dPush("maxIterGrid",50);L2_Par._dPush("boundaryK",3);L2_Par._dPush("repel",true);L2_Par._dPush("concav",1);L2_Par._dPush("noise",undefined);L2_Par._dPush("displace",undefined);L2_Par._dPush("smooth",undefined);L2_Par._dPush("shift",undefined);L2_Par["use:"]("r",L2_Ops);L2_D._dPush("grid",undefined)._dPush("cost",undefined)._dPush("candidateOps",new L2.Box(L2_Par));var L2_TableOp=new L2.ArJSA([function(L2_k){if(L2_k instanceof L2.Ar)L2_k=L2_k.v[0];return L2.sc.unwrap(L2.pf.ew.isBox(L2_Par._vEnt(L2_k))?L2_Par._vEnt(L2_k):L2.pf.ew.box(L2_Par._vEnt(L2_k)))}]);var L2_Noise=L2.tab(L2_TableOp.v[0]("noise"));var L2_Displace=L2.tab(L2_TableOp.v[0]("displace"));var L2_Smooth=L2.tab(L2_TableOp.v[0]("smooth"));var L2_Shift=L2.tab(L2_TableOp.v[0]("shift"));var L2_Grid=new L2.ArSh(new L2.ArJSA([L2_Noise.r*L2_Displace.r*L2_Smooth.r*L2_Shift.r,15]))["key:"]("c",undefined,new L2.ArJSA(["noise","displace"])._appendSc("smooth","r")._appendSc("shift","r")._appendSc("noisyCent","r")._appendSc("dispCent","r")._appendSc("boundary","r")._appendSc("step","r")._appendSc("xy","r")._appendSc("neighb","r")._appendSc("neighbImmed","r")._appendSc("assign","r")._appendSc("invAssign","r")._appendSc("regCost","r")._appendSc("rough","r"));var L2_g=0;var L2_Region=L2.sc.unwrap(L2_D._dEnt("region"));var L2_nR=L2_Region.r;var L2_RegNeighb=L2.sc.unwrap(L2_D._dEnt("regNeighb"));var L2_RegSqDist=L2.tab(L2_sqDistMat(L2.sc.unwrap(L2_D._dEnt("cent"))))["key:"]("r",undefined,L2_Region)["key:"]("c",undefined,L2_Region);var L2_Boundary=L2.sc.unwrap(L2_D._dEnt("boundaryEq"));var L2_estGridStep=L2.symb.as["/"](L2.tab(L2_Poly._dEnt("area")(L2_Boundary)),L2_nR)._map(L2.pf.ew.sqrt).v[0];var L2_repel=L2_Par._dEnt("repel");var L2_concav=L2_Par._dEnt("concav");var L2_bigPoints=function(L2_X,L2_a){if(!(L2_X instanceof L2.Ar))L2_X=new L2.ArJSA([L2_X]);if(L2_a instanceof L2.Ar)L2_a=L2_a.v[0];L2_X=new L2.ArCopy(L2_X,false);var L2_Theta=L2.sc.range(0,2*Math.PI,.4);var L2_Circle=L2.symb.as["*"](L2_Theta._map(L2.pf.ew.cos)._appendAr(L2_Theta._map(L2.pf.ew.sin),"c"),L2_a);var L2_tn=L2_Theta.r;var L2_Y=new L2.ArSh(new L2.ArJSA([L2_tn*L2_X.r,2]));var L2_i=0;var L2_i_limit_=L2_X.r;for(;L2_i<L2_i_limit_;L2_i++){L2_Y["slice:"]("r",L2_i*L2_tn,(L2_i+1)*L2_tn-1,L2.symb.aa.apply("+",L2_X._oneDimSc("r",L2_i)["to"](L2_Circle),L2_Circle))}return L2_Y};var L2_concaveHull=function(L2_X){if(!(L2_X instanceof L2.Ar))L2_X=new L2.ArJSA([L2_X]);L2_X=L2.tab(L2_bigPoints(L2_X,L2_estGridStep/2));return L2.linAlg.unmatrix([concaveman(L2.linAlg.matrix(L2_X)[0],L2_concav)]);undefined};var L2_ns_index_=0;var L2_ns_limit_=L2_Noise.v.length;var L2_ns=L2_Noise.v[0];for(;L2_ns_index_<L2_ns_limit_;L2_ns=L2_Noise.v[++L2_ns_index_]){L2_Cent=L2.sc.unwrap(L2_D._dEnt("cent"));if(L2_ns){L2_Cent=L2.symb.aa.apply("+",L2_Cent,L2.symb.aa.apply("*",L2.aux.normal(new L2.ArJSA([L2_nR,2]),true),L2.symb.as["*"](L2_RegNeighb["map"](function(L2_A,L2_j){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);if(L2_j instanceof L2.Ar)L2_j=L2_j.v[0];return L2_RegSqDist._twoDim("r","c",L2_A,new L2.ArJSA([L2_j]))["mean"]("r")})._map(L2.pf.ew.unbox),L2.pf.math["^"](L2_ns,2))._map(L2.pf.ew.sqrt)["rep"]("c")))}if(L2_Displace["any"]("r").v[0]){L2_SqDistCB=L2.tab(L2_sqDistMat(L2_Cent,L2_Boundary));L2_DispVecs=L2.symb.as["*"](L2.tab(L2_unitLen(L2_Cent["outer"](L2_Cent,function(L2_R1,L2_R2){if(!(L2_R1 instanceof L2.Ar))L2_R1=new L2.ArJSA([L2_R1]);if(!(L2_R2 instanceof L2.Ar))L2_R2=new L2.ArJSA([L2_R2]);return new L2.Box(new L2.ArTp(new L2.ArCopy(L2.symb.aa.apply("-",L2_R2,L2_R1),false),"rpc"))})["unwrap"]("p"),"p")),L2_estGridStep);L2_DispVecsNeighb=L2_Region["map"](function(L2_a){if(L2_a instanceof L2.Ar)L2_a=L2_a.v[0];return new L2.ArTp(L2_DispVecs._twoDim("r","c",L2.sc.unwrap(L2_RegNeighb._vEnt(L2_a)),new L2.ArJSA([L2_a])),"rpc")["mean"]("r")})["unwrap"]("c")["key:"]("r",undefined,L2_Region);L2_Old=L2_Cent;if(L2_repel){L2_DispVecsNonAll=L2_Region["map"](function(L2_a){if(L2_a instanceof L2.Ar)L2_a=L2_a.v[0];return new L2.Box(new L2.ArTp(L2_DispVecs._twoDim("r","c",L2_Region["diff"](L2.sc.unwrap(L2_RegNeighb._vEnt(L2_a))._appendSc(L2_a,"r")),new L2.ArJSA([L2_a]))["key:"]("c",undefined,undefined),"rpc"))})["key:"]("r",undefined,L2_Region);L2_DispVecsNonKey=L2_DispVecsNonAll["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A["key"]("r")});for(var L2_i=1;L2_i<=L2_Par._dEnt("displaceStep");L2_i+=1){L2_New=L2_Old._shell();L2_TmpDist=L2.tab(L2_sqDistMat(L2_Old))._map(L2.pf.ew.sqrt)["key:"]("r",undefined,L2_Region)["key:"]("c",undefined,L2_Region);var L2_reg_index_=0;var L2_reg_limit_=L2_Region.v.length;var L2_reg=L2_Region.v[0];for(;L2_reg_index_<L2_reg_limit_;L2_reg=L2_Region.v[++L2_reg_index_]){(function(){var L2_Recon=new L2.ArJSA([undefined]);var L2_Neighb=L2.sc.unwrap(L2_RegNeighb._vEnt(L2_reg));var L2_Non=L2.sc.unwrap(L2_DispVecsNonKey._vEnt(L2_reg));L2_Non=L2_Non._oneDimAr("r",L2.symb.as["<"](L2_TmpDist._twoDim("r","c",L2_Non,new L2.ArJSA([L2_reg])),L2_estGridStep)["find"]());if(L2_Non.r){L2_Recon=L2.symb.aa.apply("+",L2_Old._oneDimAr("r",L2_Neighb)["mean"]("r"),L2_DispVecsNeighb._oneDimSc("r",L2_reg));L2_New._oneDimSetAr("r",new L2.ArJSA([L2_reg]),L2.symb.as["/"](L2.symb.aa.apply("+",L2.symb.as["*"](L2_Recon,L2_Neighb.r),L2.symb.aa.apply("+",L2_Old._oneDimAr("r",L2_Non),L2.sc.unwrap(L2_DispVecsNonAll._vEnt(L2_reg))._oneDimAr("r",L2_Non))["sum"]("r")),L2_Neighb.r+L2_Non.r))}else{L2_New._oneDimSetAr("r",new L2.ArJSA([L2_reg]),L2.symb.aa.apply("+",L2_Old._oneDimAr("r",L2.sc.unwrap(L2_RegNeighb._vEnt(L2_reg)))["mean"]("r"),L2_DispVecsNeighb._oneDimSc("r",L2_reg)))}})()}L2_Old=L2_New}}else{for(L2_i=1;L2_i<=L2_Par._dEnt("displaceStep");L2_i+=1){L2_New=L2_Old._shell();L2_reg_index_=0;L2_reg_limit_=L2_Region.v.length;L2_reg=L2_Region.v[0];for(;L2_reg_index_<L2_reg_limit_;L2_reg=L2_Region.v[++L2_reg_index_]){L2_New._oneDimSetAr("r",new L2.ArJSA([L2_reg]),L2.symb.aa.apply("+",L2_Old._oneDimAr("r",L2.sc.unwrap(L2_RegNeighb._vEnt(L2_reg)))["mean"]("r"),L2_DispVecsNeighb._oneDimSc("r",L2_reg)))}L2_Old=L2_New}}L2_DispCent=L2_Old;L2_K=new L2.ArJSA([L2_Par._dEnt("boundaryK")])}else{L2_DispCent=L2_Cent}var L2_interp_index_=0;var L2_interp_limit_=L2_Displace.v.length;var L2_interp=L2_Displace.v[0];for(;L2_interp_index_<L2_interp_limit_;L2_interp=L2_Displace.v[++L2_interp_index_]){if(L2_interp){L2_NewCent=L2.symb.aa.apply("+",L2.symb.as["*"](L2_Cent,1-L2_interp),L2.symb.as["*"](L2_DispCent,L2_interp));if(L2_concav){L2_InterpBoundary=L2.tab(L2_Poly._dEnt("eqSpace")(L2.tab(L2_concaveHull(L2_NewCent)),L2_Boundary.r))}else{L2_InterpBoundary=L2_Boundary._shell();(function(){var L2_SqDist=new L2.ArJSA([undefined]);var L2_BoundaryNeighb=new L2.ArJSA([undefined]);var L2_NeighbWt=new L2.ArJSA([undefined]);var L2_DispVec=new L2.ArJSA([undefined]);var L2_i=0;var L2_i_limit_=L2_InterpBoundary.r;for(;L2_i<L2_i_limit_;L2_i++){L2_SqDist=L2_SqDistCB._oneDimSc("c",L2_i);L2_BoundaryNeighb=L2_SqDist["asc"]("index")["slice"]("r",0,L2.symb.as["-"](L2_K,1).v[0]);L2_NeighbWt=L2_SqDist._oneDimAr("r",L2_BoundaryNeighb);L2_NeighbWt=L2.symb.aa.apply("/",L2_NeighbWt,L2.symb.as["*"](L2_NeighbWt["min"]("r"),2))._unary()._map(L2.pf.ew.exp);L2_NeighbWt=L2.symb.aa.apply("/",L2_NeighbWt,L2_NeighbWt["sum"]("r"))["rep"]("c");L2_DispVec=L2.symb.aa.apply("*",L2.symb.aa.apply("-",L2_Boundary._oneDimSc("r",L2_i)["rep"]("r",L2_K.v[0]),L2_Cent._oneDimAr("r",L2_BoundaryNeighb)),L2_NeighbWt)["sum"]("r");L2_DispVec=L2.symb.aa.apply("*",L2_DispVec,L2.symb.sa["/"](L2_estGridStep,L2_DispVec._map_1_as(L2.pf.math["^"],2)["sum"]("c")._map(L2.pf.ew.sqrt))._map(L2.pf.ew.sqrt));L2_InterpBoundary._oneDimSetAr("r",new L2.ArJSA([L2_i]),L2.symb.aa.apply("+",L2.symb.aa.apply("*",L2_NewCent._oneDimAr("r",L2_BoundaryNeighb),L2_NeighbWt)["sum"]("r"),L2_DispVec))}})()}}else{L2_NewCent=new L2.ArCopy(L2_Cent,true);L2_InterpBoundary=L2_concav?L2.tab(L2_Poly._dEnt("eqSpace")(L2.tab(L2_concaveHull(L2_Cent)),L2_Boundary.r)):new L2.ArCopy(L2_Boundary,true)}var L2_sm_index_=0;var L2_sm_limit_=L2_Smooth.v.length;var L2_sm=L2_Smooth.v[0];for(;L2_sm_index_<L2_sm_limit_;L2_sm=L2_Smooth.v[++L2_sm_index_]){if(L2_sm){L2_NewBoundary=L2.tab(L2_Poly._dEnt("smooth")(L2_InterpBoundary,L2_sm,"rbf"))}else{L2_NewBoundary=L2_InterpBoundary}var L2_gs_index_=0;var L2_gs_limit_=L2_Shift.v.length;var L2_gs=L2_Shift.v[0];for(;L2_gs_index_<L2_gs_limit_;L2_gs=L2_Shift.v[++L2_gs_index_]){L2_NewGrid=L2.tab(L2_GridFuncs._dEnt("inPoly")(L2_nR,L2_NewBoundary,L2_Par._dEnt("tile"),L2_gs,L2_Par._dEnt("maxIterGrid")));L2_DistWrap=L2.tab(L2_sqDistMat(L2.sc.unwrap(L2_NewGrid._dEnt("xy"))))._map(L2.pf.ew.sqrt)["wrap"]("c");L2_NewNeighbImmed=L2_DistWrap["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.symb.aa.apply("&&",L2.symb.as["<="](L2_A,L2_NewGrid._dEnt("step")*1.0001),L2_A)["find"]()});if(L2_Par._dEnt("tile").substr(0,3)==="hex"){L2_NewNeighb=L2_NewNeighbImmed;var L2_unitTileArea=L2.pf.ew.sqrt(3)*3/2;var L2_side=6}else if(L2_Par._dEnt("tile")==="sq"){L2_NewNeighb=L2_DistWrap["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.symb.aa.apply("&&",L2.symb.as["<="](L2_A,L2.pf.ew.sqrt(2)*(L2_NewGrid._dEnt("step")*1.0001)),L2_A)["find"]()});L2_unitTileArea=1;L2_side=4}else{L2_NewNeighb=L2_DistWrap["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.symb.aa.apply("&&",L2.symb.as["<="](L2_A,2*(L2_NewGrid._dEnt("step")*1.0001)),L2_A)["find"]()});L2_unitTileArea=L2.pf.ew.sqrt(3)/4;L2_side=3}var L2_minPerim=L2.pf.ew.sqrt(L2_nR*L2_unitTileArea*Math.PI)*2;var L2_rough=L2.symb.as["/"](L2.symb.as["-"](L2.symb.sa["-"](L2_nR*L2_side,L2_NewNeighbImmed["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A.r})["sum"]("r")),L2_minPerim),L2_minPerim).v[0];L2_SqDist=L2.tab(L2_sqDistMat(L2_NewCent,L2.sc.unwrap(L2_NewGrid._dEnt("xy"))));L2_Hungarian=L2.tab(L2_munkres(L2_SqDist));L2_Assign=L2_Hungarian._oneDimSc("c",1)["key:"]("r",undefined,L2_Region._oneDimAr("r",L2_Hungarian._oneDimSc("c",0)))._oneDimAr("r",L2_Region);L2_InvAssign=L2_Region._oneDimAr("r",L2_Assign["asc"]("index"));L2_RegCost=new L2.ArSh(new L2.ArJSA([L2_nR,3]),0)["key:"]("r",undefined,L2_Region)["key:"]("c",undefined,new L2.ArJSA(["distance","angle"])._appendSc("adjacency","r"));L2_RegCost._oneDimSetAr("c",new L2.ArJSA(["distance"]),L2.symb.as["/"](L2_SqDist._vrcp(L2_SqDist["ind"]("r"),L2_Assign)._map(L2.pf.ew.sqrt),L2_estGridStep));L2_NewAngle=L2.tab(L2_angleMat(L2.sc.unwrap(L2_NewGrid._dEnt("xy")),L2.sc.unwrap(L2_NewGrid._dEnt("xy"))));L2_RegCost._oneDimSetAr("c",new L2.ArJSA(["angle"]),L2.sc.unwrap(L2_D._dEnt("regNeighb"))["map"](function(L2_A,L2_j){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);if(L2_j instanceof L2.Ar)L2_j=L2_j.v[0];return L2.tab(L2_angleDiff(L2.sc.unwrap(L2_D._dEnt("angle"))._twoDim("r","c",L2_A,new L2.ArJSA([L2_j])),L2_NewAngle._twoDim("r","c",L2_Assign._oneDimAr("r",L2_A),new L2.ArJSA([L2_Assign.v[+L2_j]]))))["mean"]("r")})._map(L2.pf.ew.unbox));L2_RegCost._oneDimSetAr("c",new L2.ArJSA(["adjacency"]),L2.sc.unwrap(L2_D._dEnt("regNeighb"))["map"](function(L2_A,L2_j){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);if(L2_j instanceof L2.Ar)L2_j=L2_j.v[0];return(L2_A.r-L2_A["inter"](L2_InvAssign._oneDimAr("r",L2.sc.unwrap(L2_NewNeighb._vEnt(L2_Assign.v[+L2_j])))).r)/L2_A.r})._map(L2.pf.ew.unbox));L2_Grid._oneDimSetAr("r",new L2.ArJSA([L2_g]),new L2.ArTp(new L2.ArJSA([L2_ns,L2_interp])._appendSc(L2_sm,"r")._appendSc(L2_gs,"r")._appendSc(new L2.Box(L2_Cent),"r")._appendSc(new L2.Box(L2_NewCent),"r")._appendSc(new L2.Box(L2_NewBoundary),"r")._appendAr(L2_NewGrid,"r")._appendSc(new L2.Box(L2_NewNeighb),"r")._appendSc(new L2.Box(L2_NewNeighbImmed),"r")._appendSc(new L2.Box(L2_Assign),"r")._appendSc(new L2.Box(L2_InvAssign),"r")._appendSc(new L2.Box(L2_RegCost),"r")._appendSc(L2_rough,"r")));L2_g=L2_g+1}}}}return L2_D._dPush("grid",new L2.Box(L2_Grid))._dPush("estStep",L2_estGridStep)};L2_Tile._dPush("tileMap",L2_tileMap);var L2_cost=function(L2_D,L2_W){if(!(L2_D instanceof L2.Ar))L2_D=new L2.ArJSA([L2_D]);if(!(L2_W instanceof L2.Ar))L2_W=new L2.ArJSA([L2_W]);var L2_Par=L2.sc.pairNone();L2_Par._dPush("distance",1);L2_Par._dPush("angle",1);L2_Par._dPush("adjacency",1);L2_Par._dPush("rough",1);L2_Par["use:"]("r",L2_W);var L2_Grid=L2.sc.unwrap(L2_D._dEnt("grid"));var L2_Key=new L2.ArJSA(["distance","angle"])._appendSc("adjacency","r");var L2_RepWt=new L2.ArTp(L2_Par._oneDimAr("r",L2_Key))["rep"]("r",L2_D._dEnt("nR"));var L2_RegCost=new L2.ArCopy(L2_Grid._oneDimSc("c","regCost"),true,"deep")["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2.symb.aa.apply("*",L2_A,L2_RepWt)});L2_RegCost["map"](function(L2_A){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);return L2_A._appendAr(L2_A["sum"]("c")["key:"]("c",undefined,"total"),"c",false,true)});var L2_TotalCost=L2.sc.unwrap(L2_RegCost._vEnt(0))._oneDimAr("c",L2_Key)["mean"]("r");var L2_lastGrid=L2_Grid.r-1;for(var L2_g=1;L2_g<=L2_lastGrid;L2_g+=1){L2_TotalCost._appendAr(L2.sc.unwrap(L2_RegCost._vEnt(L2_g))._oneDimAr("c",L2_Key)["mean"]("r"),"r",false,true)}L2_TotalCost._appendAr(L2.symb.as["*"](L2_Grid._oneDimSc("c","rough"),L2_Par._dEnt("rough"))["key:"]("c",undefined,"rough"),"c",false,true);L2_TotalCost._appendAr(L2_TotalCost["sum"]("c")["key:"]("c",undefined,"total"),"c",false,true);return L2_D._dPush("cost",new L2.Box(L2.sc.pairNone()._dPush("regCost",new L2.Box(L2_RegCost))._dPush("totalCost",new L2.Box(L2_TotalCost))._dPush("weight",new L2.Box(L2_Par))))};L2_Tile._dPush("cost",L2_cost);var L2_PlotOps=L2.sc.pairNone();L2_PlotOps._dPush("backgroundColor","#fff");L2_PlotOps._dPush("legend",0);L2_PlotOps._dPush("pin",1);L2_PlotOps._dPush("pinAt","right");L2_PlotOps._dPush("xTick",0);L2_PlotOps._dPush("yTick",0);L2_PlotOps._dPush("borderWidth",0);L2_PlotOps._dPush("fontFamily","verdana, sans-serif");L2_PlotOps._dPush("fontColor","#000");L2_PlotOps._dPush("fontSize",11);L2_PlotOps._dPush("width",600);L2_PlotOps._dPush("put",0);var L2_plotProcessed=function(L2_D,L2_adj,L2_Par){if(!(L2_D instanceof L2.Ar))L2_D=new L2.ArJSA([L2_D]);if(L2_adj instanceof L2.Ar)L2_adj=L2_adj.v[0];if(!(L2_Par instanceof L2.Ar))L2_Par=new L2.ArJSA([L2_Par]);var L2_Adj=new L2.ArJSA([undefined]);var L2_AdjPairs=new L2.ArJSA([undefined]);var L2_Ops=new L2.ArCopy(L2_PlotOps,true);L2_Ops["use:"]("r",L2_Par);var L2_Boundary=L2.sc.unwrap(L2_D._dEnt("boundary"));var L2_BoundaryRange=L2_Boundary["range"]("r");var L2_BoundaryMin=L2_Boundary["min"]("r");var L2_BoundaryMax=L2_Boundary["max"]("r");L2_Ops._dPush("height",new L2.Box(L2.symb.as["*"](L2.symb.aa.apply("/",L2_BoundaryRange._oneDimSc("c",1),L2_BoundaryRange._oneDimSc("c",0)),L2_Ops._dEnt("width"))));L2_Ops._dPush("xMin",L2_BoundaryMin.v[+0]-L2_BoundaryRange.v[+0]*.03);L2_Ops._dPush("xMax",L2_BoundaryMax.v[+0]+L2_BoundaryRange.v[+0]*.03);L2_Ops._dPush("yMin",L2_BoundaryMin.v[+1]-L2_BoundaryRange.v[+1]*.03);L2_Ops._dPush("yMax",L2_BoundaryMax.v[+1]+L2_BoundaryRange.v[+1]*.03);L2_D=new L2.ArCopy(L2_D,true,"deep");var L2_nR=L2_D._dEnt("nR");var L2_Cent=L2.sc.unwrap(L2_D._dEnt("cent"));var L2_Region=L2.sc.unwrap(L2_D._dEnt("cent"))["key"]("r");var L2_PolyList=L2.sc.unwrap(L2_D._dEnt("polyList"));var L2_nP=L2_PolyList.r;if(L2_adj){L2_Adj=L2.sc.unwrap(L2_D._dEnt("adj"));L2_AdjPairs=new L2.ArJSA([]);var L2_r1_index_=0;var L2_r1_limit_=L2_Region.v.length;var L2_r1=L2_Region.v[0];for(;L2_r1_index_<L2_r1_limit_;L2_r1=L2_Region.v[++L2_r1_index_]){var L2_r2_index_=0;var L2_r2_limit_=L2_Region.v.length;var L2_r2=L2_Region.v[0];for(;L2_r2_index_<L2_r2_limit_;L2_r2=L2_Region.v[++L2_r2_index_]){if(L2_Adj._e(L2_r1,L2_r2)){L2_AdjPairs._appendSc(new L2.Box(L2_Cent._oneDimAr("r",new L2.ArJSA([L2_r1,L2_r2]))["key:"]("r",undefined,undefined)),"r",false,true)}}}L2.sc.unwrap(L2_D._dEnt("cent"))["key:"]("r",undefined,L2.sc.unwrap(L2_D._dEnt("fmtRegion")));L2.aux.plot(L2_PolyList._appendSc(L2_D._dEnt("cent"),"r",true)._appendAr(L2_AdjPairs,"r"),"l",true,L2_Ops._dPush("linePen",new L2.Box(new L2.Ar(L2_nP+L2_AdjPairs.r,1)._appendSc(0,"r",true)._appendSc(0,"r")))._dPush("pointRadius",new L2.Box(new L2.Ar(L2_nP+L2_AdjPairs.r,0)._appendSc(3,"r",true)._appendSc(3,"r")))._dPush("color",new L2.Box(new L2.Ar(L2_nP,"#555")._appendSc("#44d","r",true)._appendAr(new L2.Ar(L2_AdjPairs.r,"#44d"),"r"))))}else{L2.sc.unwrap(L2_D._dEnt("cent"))["key:"]("r",undefined,L2.sc.unwrap(L2_D._dEnt("fmtRegion")));L2.aux.plot(L2_PolyList._appendSc(L2_D._dEnt("cent"),"r",true),"l",true,L2_Ops._dPush("linePen",new L2.Box(new L2.Ar(L2_nP,1)._appendSc(0,"r",true)))._dPush("pointRadius",new L2.Box(new L2.Ar(L2_nP,0)._appendSc(3,"r",true)))._dPush("color",new L2.Box(new L2.Ar(L2_nP,"#555")._appendSc("#44d","r",true))))}};L2_Tile._dPush("plotProcessed",L2_plotProcessed);var L2_plotAdj=function(L2_D,L2_g,L2_Par){if(!(L2_D instanceof L2.Ar))L2_D=new L2.ArJSA([L2_D]);if(L2_g instanceof L2.Ar)L2_g=L2_g.v[0];if(!(L2_Par instanceof L2.Ar))L2_Par=new L2.ArJSA([L2_Par]);var L2_Cent=new L2.ArJSA([undefined]);var L2_Ops=new L2.ArCopy(L2_PlotOps,true);L2_Ops["use:"]("r",L2_Par);if(L2_g===undefined){L2_Cent=L2.sc.unwrap(L2_D._dEnt("cent"))}else{L2_Cent=L2.sc.unwrap(L2.sc.unwrap(L2_D._dEnt("grid"))._e(L2_g,"dispCent"))}var L2_CentRange=L2_Cent["range"]("r");var L2_CentMax=L2_Cent["max"]("r");var L2_CentMin=L2_Cent["min"]("r");L2_Ops._dPush("width",600);L2_Ops._dPush("height",new L2.Box(L2.symb.as["*"](L2.symb.aa.apply("/",L2_CentRange._oneDimSc("c",1),L2_CentRange._oneDimSc("c",0)),L2_Ops._dEnt("width"))));L2_Ops._dPush("xMin",L2_CentMin.v[+0]-L2_CentRange.v[+0]*.03);L2_Ops._dPush("xMax",L2_CentMax.v[+0]+L2_CentRange.v[+0]*.03);L2_Ops._dPush("yMin",L2_CentMin.v[+1]-L2_CentRange.v[+1]*.03);L2_Ops._dPush("yMax",L2_CentMax.v[+1]+L2_CentRange.v[+1]*.03);L2_Ops._dPush("pin",0);L2_Ops._dPush("xTick",undefined);L2_Ops._dPush("yTick",undefined);L2_Ops._dPush("xGridColor","#fff");L2_Ops._dPush("yGridColor","#fff");var L2_PolyList=L2.sc.unwrap(L2_D._dEnt("polyList"));var L2_nP=L2_PolyList.r;var L2_Adj=L2.sc.unwrap(L2_D._dEnt("adj"));var L2_AdjPairs=new L2.ArJSA([]);var L2_Region=L2.sc.unwrap(L2_D._dEnt("region"));var L2_r1_index_=0;var L2_r1_limit_=L2_Region.v.length;var L2_r1=L2_Region.v[0];for(;L2_r1_index_<L2_r1_limit_;L2_r1=L2_Region.v[++L2_r1_index_]){var L2_r2_index_=0;var L2_r2_limit_=L2_Region.v.length;var L2_r2=L2_Region.v[0];for(;L2_r2_index_<L2_r2_limit_;L2_r2=L2_Region.v[++L2_r2_index_]){if(L2_Adj._e(L2_r1,L2_r2)){L2_AdjPairs._appendSc(new L2.Box(L2_Cent._oneDimAr("r",new L2.ArJSA([L2_r1,L2_r2]))["key:"]("r",undefined,undefined)),"r",false,true)}}}L2.aux.plot(L2_AdjPairs._appendSc(new L2.Box(new L2.ArCopy(L2_Cent,false)),"r"),"l",true,L2_Ops._dPush("linePen",new L2.Box(new L2.Ar(L2_AdjPairs.r,1)._appendSc(0,"r")))._dPush("pointRadius",new L2.Box(new L2.Ar(L2_AdjPairs.r,0)._appendSc(3,"r")))._dPush("color",new L2.Box(new L2.Ar(L2_AdjPairs.r,"#444")._appendSc("#44d","r"))))};L2_Tile._dPush("plotAdj",L2_plotAdj);var L2_plotDisplace=function(L2_R,L2_g,L2_Par){if(!(L2_R instanceof L2.Ar))L2_R=new L2.ArJSA([L2_R]);if(L2_g instanceof L2.Ar)L2_g=L2_g.v[0];if(!(L2_Par instanceof L2.Ar))L2_Par=new L2.ArJSA([L2_Par]);var L2_nR=L2_R._dEnt("nR");var L2_Ops=new L2.ArCopy(L2_PlotOps,true);L2_Ops["use:"]("r",L2_Par);L2_Ops._dPush("pin",0);L2_Ops._dPush("color",new L2.Box(new L2.ArJSA(["#999","#080"])._appendAr(new L2.Ar(L2_nR,"#aaa"),"r")._appendSc("#aaa","r")._appendAr(new L2.Ar(L2_nR,"#777"),"r")._appendSc("#777","r")._appendSc("#080","r")));L2_Ops._dPush("pointRadius",new L2.Box(new L2.ArJSA([0,0])._appendAr(new L2.Ar(L2_nR,0),"r")._appendSc(1.5,"r")._appendAr(new L2.Ar(L2_nR,0),"r")._appendSc(2,"r")._appendSc(2.5,"r")));L2_Ops._dPush("linePen",new L2.Box(new L2.ArJSA([1,1])._appendAr(new L2.Ar(L2_nR,.7),"r")._appendSc(0,"r")._appendAr(new L2.Ar(L2_nR,.7),"r")._appendSc(0,"r")._appendSc(0,"r")));var L2_Cent=new L2.ArJSA([L2_R._dEnt("cent")]);var L2_NoisyCent=new L2.ArJSA([L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"noisyCent")]);var L2_DispCent=new L2.ArJSA([L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"dispCent")]);var L2_Boundary=new L2.ArJSA([L2_R._dEnt("boundary")]);var L2_NewBoundary=new L2.ArJSA([L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"boundary")]);var L2_AllBoundary=L2.sc.unwrap(L2_Boundary.v[0])._appendAr(L2.sc.unwrap(L2_NewBoundary.v[0]),"r");var L2_AllBoundaryRange=L2_AllBoundary["range"]("r");var L2_AllBoundaryMin=L2_AllBoundary["min"]("r");var L2_AllBoundaryMax=L2_AllBoundary["max"]("r");L2_Ops._dPush("height",L2_AllBoundaryRange.v[+1]/L2_AllBoundaryRange.v[+0]*L2_Ops._dEnt("width"));L2_Ops._dPush("xMin",L2_AllBoundaryMin.v[+0]);L2_Ops._dPush("xMax",L2_AllBoundaryMax.v[+0]);L2_Ops._dPush("yMin",L2_AllBoundaryMin.v[+1]);L2_Ops._dPush("yMax",L2_AllBoundaryMax.v[+1]);var L2_NoisyCentWrap=new L2.ArCopy(L2.sc.unwrap(L2_NoisyCent.v[0]),false)["wrap"]("c");var L2_DispCentWrap=new L2.ArCopy(L2.sc.unwrap(L2_DispCent.v[0]),false)["wrap"]("c");L2.aux.plot(new L2.ArCopy(L2_Boundary,false)._appendAr(L2_NewBoundary,"r")._appendAr(new L2.ArCopy(L2.sc.unwrap(L2_Cent.v[0]),false)["wrap"]("c")["map"](function(L2_A,L2_j){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);if(L2_j instanceof L2.Ar)L2_j=L2_j.v[0];return L2_A._appendAr(L2.sc.unwrap(L2_NoisyCentWrap._oneDimSc("r",L2_j).v[0]),"r")}),"r")._appendAr(L2_Cent,"r")._appendAr(new L2.ArCopy(L2.sc.unwrap(L2_NoisyCent.v[0]),false)["wrap"]("c")["map"](function(L2_A,L2_j){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);if(L2_j instanceof L2.Ar)L2_j=L2_j.v[0];return L2_A._appendAr(L2.sc.unwrap(L2_DispCentWrap._oneDimSc("r",L2_j).v[0]),"r")}),"r")._appendAr(L2_NoisyCent,"r")._appendAr(L2_DispCent,"r"),"l",true,L2_Ops)};L2_Tile._dPush("plotDisplace",L2_plotDisplace);var L2_plotDisplaceOnly=function(L2_R,L2_g,L2_Par){if(!(L2_R instanceof L2.Ar))L2_R=new L2.ArJSA([L2_R]);if(L2_g instanceof L2.Ar)L2_g=L2_g.v[0];if(!(L2_Par instanceof L2.Ar))L2_Par=new L2.ArJSA([L2_Par]);var L2_Ops=new L2.ArCopy(L2_PlotOps,true);L2_Ops["use:"]("r",L2_Par);var L2_Boundary=new L2.ArJSA([L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"boundary")]);var L2_BoundaryRange=L2.sc.unwrap(L2_Boundary.v[0])["range"]("r");var L2_BoundaryMin=L2.sc.unwrap(L2_Boundary.v[0])["min"]("r");var L2_BoundaryMax=L2.sc.unwrap(L2_Boundary.v[0])["max"]("r");L2_Ops._dPush("height",L2_BoundaryRange.v[+1]/L2_BoundaryRange.v[+0]*L2_Ops._dEnt("width"));L2_Ops._dPush("xMin",L2_BoundaryMin.v[+0]-L2_BoundaryRange.v[+0]*.03);L2_Ops._dPush("xMax",L2_BoundaryMax.v[+0]+L2_BoundaryRange.v[+0]*.03);L2_Ops._dPush("yMin",L2_BoundaryMin.v[+1]-L2_BoundaryRange.v[+1]*.03);L2_Ops._dPush("yMax",L2_BoundaryMax.v[+1]+L2_BoundaryRange.v[+1]*.03);var L2_Cent=L2.sc.unwrap(L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"dispCent"));var L2_Region=L2.sc.unwrap(L2_R._dEnt("region"));var L2_Adj=L2.sc.unwrap(L2_R._dEnt("adj"));var L2_AdjPairs=new L2.ArJSA([]);var L2_r1_index_=0;var L2_r1_limit_=L2_Region.v.length;var L2_r1=L2_Region.v[0];for(;L2_r1_index_<L2_r1_limit_;L2_r1=L2_Region.v[++L2_r1_index_]){var L2_r2_index_=0;var L2_r2_limit_=L2_Region.v.length;var L2_r2=L2_Region.v[0];for(;L2_r2_index_<L2_r2_limit_;L2_r2=L2_Region.v[++L2_r2_index_]){if(L2_Adj._e(L2_r1,L2_r2)){L2_AdjPairs._appendSc(new L2.Box(L2_Cent._oneDimAr("r",new L2.ArJSA([L2_r1,L2_r2]))["key:"]("r",undefined,undefined)),"r",false,true)}}}L2_Ops._dPush("color",new L2.Box(new L2.ArJSA(["#080","#080"])._appendAr(new L2.Ar(L2_AdjPairs.r,"#44d"),"r")));L2_Ops._dPush("pointRadius",new L2.Box(new L2.ArJSA([0,3])._appendAr(new L2.Ar(L2_AdjPairs.r,0),"r")));L2_Ops._dPush("linePen",new L2.Box(new L2.ArJSA([1,0])._appendAr(new L2.Ar(L2_AdjPairs.r,1),"r")));L2.aux.plot(L2_Boundary._appendSc(new L2.Box(new L2.ArCopy(L2_Cent,true)["key:"]("r",undefined,L2.sc.unwrap(L2_R._dEnt("fmtRegion")))),"r")._appendAr(L2_AdjPairs,"r"),"l",true,L2_Ops)};L2_Tile._dPush("plotDisplaceOnly",L2_plotDisplaceOnly);var L2_triOrient=function(L2_D,L2_g){if(!(L2_D instanceof L2.Ar))L2_D=new L2.ArJSA([L2_D]);if(L2_g instanceof L2.Ar)L2_g=L2_g.v[0];var L2_PossAngle=new L2.ArJSA([undefined]);var L2_tile=L2.sc._dEnt(L2_D._dEnt("candidateOps"),"tile");if(L2_tile==="tri-base"){L2_PossAngle=new L2.ArJSA([Math.PI/6,5*Math.PI/6])._appendSc(-(Math.PI/2),"r")}else if(L2_tile==="tri-side"){L2_PossAngle=new L2.ArJSA([-Math.PI,Math.PI])._appendSc(Math.PI/3,"r")._appendSc(-(Math.PI/3),"r")}else{return undefined}var L2_Grid=L2.sc.unwrap(L2.aux.openIfBox(L2_D._dEnt("grid"))._e(L2_g,"xy"));var L2_Immed=L2.sc.unwrap(L2.aux.openIfBox(L2_D._dEnt("grid"))._e(L2_g,"neighbImmed"));return L2_Immed["map"](function(L2_A,L2_j){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);if(L2_j instanceof L2.Ar)L2_j=L2_j.v[0];return L2_PossAngle["outer"](new L2.ArTp(L2.tab(L2_angleMat(L2_Grid._oneDimSc("r",L2_j),L2_Grid._oneDimAr("r",L2_A)))),function(L2_a,L2_b){if(L2_a instanceof L2.Ar)L2_a=L2_a.v[0];if(L2_b instanceof L2.Ar)L2_b=L2_b.v[0];return L2.pf.ew.abs(L2_a-L2_b)<.1})["any"]("e")})._map(L2.pf.ew.unbox)};L2_Tile._dPush("triOrient",L2_triOrient);var L2_square=function(L2_Center,L2_radius){if(!(L2_Center instanceof L2.Ar))L2_Center=new L2.ArJSA([L2_Center]);if(L2_radius instanceof L2.Ar)L2_radius=L2_radius.v[0];var L2_pos=L2_radius/L2.pf.ew.sqrt(2);var L2_neg=-L2_pos;return L2.symb.aa.apply("+",new L2.ArJSA([L2_pos,L2_neg,L2_neg,L2_pos,L2_pos,L2_pos,L2_pos,L2_neg,L2_neg,L2_pos])["morph"](new L2.ArJSA([5,2])),L2_Center["rep"]("r",5))};var L2_hexSide=function(L2_Center,L2_radius){if(!(L2_Center instanceof L2.Ar))L2_Center=new L2.ArJSA([L2_Center]);if(L2_radius instanceof L2.Ar)L2_radius=L2_radius.v[0];var L2_x=L2_radius*(L2.pf.ew.sqrt(3)/2);var L2_y=L2_radius/2;return L2.symb.aa.apply("+",new L2.ArJSA([L2_x,0,-L2_x,-L2_x,0,L2_x,L2_x,L2_y,L2_radius,L2_y,-L2_y,-L2_radius,-L2_y,L2_y])["morph"](new L2.ArJSA([7,2])),L2_Center["rep"]("r",7))};var L2_hexBase=function(L2_Center,L2_radius){if(!(L2_Center instanceof L2.Ar))L2_Center=new L2.ArJSA([L2_Center]);if(L2_radius instanceof L2.Ar)L2_radius=L2_radius.v[0];var L2_x=L2_radius/2;var L2_y=L2_radius*(L2.pf.ew.sqrt(3)/2);return L2.symb.aa.apply("+",new L2.ArJSA([-L2_radius,-L2_x,L2_x,L2_radius,L2_x,-L2_x,-L2_radius,0,L2_y,L2_y,0,-L2_y,-L2_y,0])["morph"](new L2.ArJSA([7,2])),L2_Center["rep"]("r",7))};var L2_triSide=function(L2_Center,L2_radius,L2_ptRight){if(!(L2_Center instanceof L2.Ar))L2_Center=new L2.ArJSA([L2_Center]);if(L2_radius instanceof L2.Ar)L2_radius=L2_radius.v[0];if(L2_ptRight instanceof L2.Ar)L2_ptRight=L2_ptRight.v[0];var L2_Coord=new L2.ArJSA([undefined]);var L2_x=L2_radius/2;var L2_y=L2_radius*(L2.pf.ew.sqrt(3)/2);if(L2_ptRight){L2_Coord=new L2.ArJSA([-L2_x,L2_radius,-L2_x,-L2_x,L2_y,0,-L2_y,L2_y])}else{L2_Coord=new L2.ArJSA([-L2_radius,L2_x,L2_x,-L2_radius,0,L2_y,-L2_y,0])}return L2.symb.aa.apply("+",L2_Coord["morph"](new L2.ArJSA([4,2])),L2_Center["rep"]("r",4))};var L2_triBase=function(L2_Center,L2_radius,L2_ptUp){if(!(L2_Center instanceof L2.Ar))L2_Center=new L2.ArJSA([L2_Center]);if(L2_radius instanceof L2.Ar)L2_radius=L2_radius.v[0];if(L2_ptUp instanceof L2.Ar)L2_ptUp=L2_ptUp.v[0];var L2_Coord=new L2.ArJSA([undefined]);var L2_x=L2_radius*(L2.pf.ew.sqrt(3)/2);var L2_y=L2_radius/2;if(L2_ptUp){L2_Coord=new L2.ArJSA([-L2_x,0,L2_x,-L2_x,-L2_y,L2_radius,-L2_y,-L2_y])}else{L2_Coord=new L2.ArJSA([-L2_x,L2_x,0,-L2_x,L2_y,L2_y,-L2_radius,L2_y])}return L2.symb.aa.apply("+",L2_Coord["morph"](new L2.ArJSA([4,2])),L2_Center["rep"]("r",4))};var L2_Shape=new L2.ArSh(new L2.ArJSA([5,2]))["key:"]("r",undefined,new L2.ArJSA(["sq","hex-base"])._appendSc("hex-side","r")._appendSc("tri-base","r")._appendSc("tri-side","r"))["key:"]("c",undefined,new L2.ArJSA(["rad","draw"]));L2_Shape._oneDimSetAr("c",new L2.ArJSA(["rad"]),L2.symb.sa["/"](1,new L2.ArJSA([L2.pf.ew.sqrt(2),L2.pf.ew.sqrt(3)])._appendSc(L2.pf.ew.sqrt(3),"r")._appendSc(1,"r")._appendSc(1,"r")));L2_Shape._oneDimSetAr("c",new L2.ArJSA(["draw"]),new L2.ArJSA([L2_square,L2_hexBase])._appendSc(L2_hexSide,"r")._appendSc(L2_triBase,"r")._appendSc(L2_triSide,"r"));var L2_circle=function(L2_Center,L2_radius){if(!(L2_Center instanceof L2.Ar))L2_Center=new L2.ArJSA([L2_Center]);if(L2_radius instanceof L2.Ar)L2_radius=L2_radius.v[0];var L2_T=L2.sc.range(Math.PI,3*Math.PI,.2)._appendSc(Math.PI,"r");var L2_Coords=L2.symb.as["*"](L2_T._map(L2.pf.ew.cos)._appendAr(L2_T._map(L2.pf.ew.sin),"c"),L2_radius);return L2.symb.aa.apply("+",L2_Coords,L2_Center["rep"]("r",L2_Coords.r))};var L2_plotGrid=function(L2_R,L2_g,L2_Par,L2_showTile){if(!(L2_R instanceof L2.Ar))L2_R=new L2.ArJSA([L2_R]);if(L2_g instanceof L2.Ar)L2_g=L2_g.v[0];if(!(L2_Par instanceof L2.Ar))L2_Par=new L2.ArJSA([L2_Par]);if(L2_showTile instanceof L2.Ar)L2_showTile=L2_showTile.v[0];var L2_Ops=new L2.ArCopy(L2_PlotOps,true);L2_Ops["use:"]("r",L2_Par);L2_Ops._dPush("pinAt","bottom");L2_R=new L2.ArCopy(L2_R,true,"deep");var L2_nR=L2_R._dEnt("nR");var L2_Grid=L2.sc.unwrap(L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"xy"));L2_Grid["key:"]("r",undefined,L2_Grid["ind"]("r"));var L2_Boundary=L2.sc.unwrap(L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"boundary"));var L2_tile=L2.sc._dEnt(L2_R._dEnt("candidateOps"),"tile");var L2_tri=L2_tile.substr(0,3)==="tri";var L2_step=L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"step");var L2_Orient=L2.tab(L2_triOrient(L2_R,L2_g));var L2_rad=L2_Shape["_barEnt2"](L2_tile,"rad")*L2_step;var L2_drawFunc=L2_Shape["_barEnt2"](L2_tile,"draw");var L2_AllPtMin=L2_Boundary._appendAr(L2.symb.as["-"](L2_Grid,L2_rad),"r")["min"]("r");var L2_AllPtMax=L2_Boundary._appendAr(L2.symb.as["+"](L2_Grid,L2_rad),"r")["max"]("r");var L2_AllPtRange=L2.symb.aa.apply("-",L2_AllPtMax,L2_AllPtMin);L2_Ops._dPush("height",L2_AllPtRange.v[+1]/L2_AllPtRange.v[+0]*L2_Ops._dEnt("width"));L2_Ops._dPush("xMin",L2_AllPtMin.v[+0]);L2_Ops._dPush("xMax",L2_AllPtMax.v[+0]);L2_Ops._dPush("yMin",L2_AllPtMin.v[+1]);L2_Ops._dPush("yMax",L2_AllPtMax.v[+1]);L2_Ops._dPush("pin",0);if(L2_showTile){L2_Ops._dPush("pointRadius",new L2.Box(new L2.ArJSA([3,0])._appendSc(3,"r")._appendAr(new L2.Ar(L2_nR,0),"r")));L2_Ops._dPush("linePen",new L2.Box(new L2.ArJSA([0,.7])._appendSc(0,"r")._appendAr(new L2.Ar(L2_nR,.5),"r")));L2_Ops._dPush("color",new L2.Box(new L2.ArJSA(["#080","#080"])._appendSc("#c0c","r")._appendAr(new L2.Ar(L2_nR,"#444"),"r")));L2.aux.plot(L2.sc.unwrap(L2_R._dEnt("grid"))._twoDim("r","c",new L2.ArJSA([L2_g]),new L2.ArJSA(["dispCent"]))._appendSc(new L2.Box(L2_Boundary),"r")._appendSc(new L2.Box(L2_Grid),"r")._appendAr(L2_Grid["wrap"]("c")["map"](function(L2_A,L2_j){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);if(L2_j instanceof L2.Ar)L2_j=L2_j.v[0];return L2.tab(L2_drawFunc(L2_A,L2_rad,L2_Orient.v[+L2_j]))})["key:"]("r",undefined,undefined),"r"),"p",true,L2_Ops)}else{L2_Ops._dPush("pointRadius",new L2.Box(new L2.ArJSA([0,2])));L2_Ops._dPush("linePen",new L2.Box(new L2.ArJSA([1,0])));L2_Ops._dPush("color",new L2.Box(new L2.ArJSA(["#080","#c0c"])));L2.aux.plot(new L2.ArJSA([new L2.Box(L2_Boundary),new L2.Box(L2_Grid)]),"p",true,L2_Ops)}};L2_Tile._dPush("plotGrid",L2_plotGrid);var L2_plotTileMap=function(L2_R,L2_NewOps,L2_Arg){if(!(L2_R instanceof L2.Ar))L2_R=new L2.ArJSA([L2_R]);if(!(L2_NewOps instanceof L2.Ar))L2_NewOps=new L2.ArJSA([L2_NewOps]);if(!(L2_Arg instanceof L2.Ar))L2_Arg=new L2.ArJSA([L2_Arg]);var L2_Inten=new L2.ArJSA([undefined]);var L2_Par=L2.sc.pairMult("ind",0,"cost","total","circle",undefined);L2_Par["use:"]("r",L2_Arg);var L2_g=L2_Par._dEnt("ind");var L2_nR=L2_R._dEnt("nR");var L2_Ops=new L2.ArCopy(L2_PlotOps,true);L2_Ops["use:"]("r",L2_NewOps);L2_Ops._dPush("linePen",new L2.Box(new L2.Ar(L2_nR,.2)._appendSc(0,"r")));L2_Ops._dPush("pointRadius",0);L2_Ops._dPush("pointPen",0);L2_Ops._dPush("color",new L2.Box(new L2.Ar(L2_nR+1,"#444")));L2_Ops._dPush("pinAt","top");L2_Ops._dPush("lineFill",new L2.Box(new L2.Ar(L2_nR,1)._appendSc(0,"r")));var L2_Region=L2.sc.unwrap(L2_R._dEnt("region"));var L2_Assign=L2.sc.unwrap(L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"assign"));var L2_Grid=L2.sc.unwrap(L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"xy"))._oneDimAr("r",L2_Assign)["key:"]("r",undefined,L2.sc.unwrap(L2_R._dEnt("fmtRegion")));if(L2_NewOps["info"]()){L2_Grid["fmt:"]("r",function(L2_x){if(L2_x instanceof L2.Ar)L2_x=L2_x.v[0];return L2_x.substr(0,L2_NewOps["info"]())})}var L2_tile=L2.sc._dEnt(L2_R._dEnt("candidateOps"),"tile");var L2_tri=L2_tile.substr(0,3)==="tri";var L2_step=L2.aux.openIfBox(L2_R._dEnt("grid"))._e(L2_g,"step");var L2_Orient=L2.tab(L2_triOrient(L2_R,L2_g));if(L2_Orient.r>1){L2_Orient=L2_Orient._oneDimAr("r",L2_Assign)}var L2_rad=L2_Shape["_barEnt2"](L2_tile,"rad")*L2_step*.96;L2_Ops._dPush("height",new L2.Box(L2.symb.as["*"](L2.symb.aa.apply("/",L2_Grid._oneDimSc("c",1)["range"]("r"),L2_Grid._oneDimSc("c",0)["range"]("r")),L2_Ops._dEnt("width"))));L2_Ops._dPush("xMin",new L2.Box(L2.symb.as["-"](L2_Grid._oneDimSc("c",0)["min"]("r"),L2_rad)))._dPush("xMax",new L2.Box(L2.symb.as["+"](L2_Grid._oneDimSc("c",0)["max"]("r"),L2_rad)));L2_Ops._dPush("yMin",new L2.Box(L2.symb.as["-"](L2_Grid._oneDimSc("c",1)["min"]("r"),L2_rad)))._dPush("yMax",new L2.Box(L2.symb.as["+"](L2_Grid._oneDimSc("c",1)["max"]("r"),L2_rad)));if(L2_Par._dEnt("circle")){var L2_drawFunc=L2_circle;if(L2_tile==="sq"){L2_rad=L2_rad/L2.pf.ew.sqrt(2)}else{L2_rad=L2_rad*(L2.pf.ew.sqrt(3)/2)}}else{L2_drawFunc=L2_Shape["_barEnt2"](L2_tile,"draw")}if(L2_Par._dEnt("cost")){L2_Inten=new L2.ArCopy(L2.sc.unwrap(L2.aux.openIfBox(L2.sc._dEnt(L2_R._dEnt("cost"),"regCost"))._vEnt(L2_g))._oneDimSc("c",L2_Par._dEnt("cost")),false);if(L2.symb.as["=="](L2_Inten["first"]("r"),Infinity).v[0]){L2_Inten=new L2.Ar(L2_nR,"122,122")}else{L2_Inten=L2.symb.as["*"](L2.symb.sa["-"](1,L2.symb.aa.apply("/",L2.symb.aa.apply("-",L2_Inten,L2_Inten["min"]("r")),L2_Inten["range"]("r"))),255)._map(L2.pf.ew.round)["rep"]("c")["join"]("c")}L2_Ops._dPush("lineFillColor",new L2.Box(L2.symb.as["+"](L2.symb.sa["+"]("rgb(255,",L2_Inten),")")))}else{L2_Ops._dPush("lineFillColor","rgb(255,122,122)")}var L2_LowerCent=new L2.ArCopy(L2_Grid,true);L2_LowerCent._oneDimSetAr("c",new L2.ArJSA([1]),L2.symb.as["-"](L2_LowerCent._oneDimSc("c",1),L2_rad*.2));L2.aux.plot(L2_Grid["wrap"]("c")["map"](function(L2_A,L2_j){if(!(L2_A instanceof L2.Ar))L2_A=new L2.ArJSA([L2_A]);if(L2_j instanceof L2.Ar)L2_j=L2_j.v[0];return L2.tab(L2_drawFunc(L2_A,L2_rad,L2_Orient.v[+L2_j]))})["key:"]("r",undefined,undefined)._appendSc(new L2.Box(L2_LowerCent),"r"),"p",true,L2_Ops)};L2_Tile._dPush("plotTileMap",L2_plotTileMap);var L2_plotCost=function(L2_R,L2_nMax,L2_Par){if(!(L2_R instanceof L2.Ar))L2_R=new L2.ArJSA([L2_R]);if(L2_nMax instanceof L2.Ar)L2_nMax=L2_nMax.v[0];if(!(L2_Par instanceof L2.Ar))L2_Par=new L2.ArJSA([L2_Par]);var L2_Ops=L2.sc.pairNone();L2_Ops._dPush("backgroundColor","#fff");L2_Ops._dPush("fontFamily","verdana, sans-serif");L2_Ops._dPush("fontColor","#000");L2_Ops._dPush("fontSize",11);L2_Ops._dPush("width",500);L2_Ops._dPush("height",200);L2_Ops._dPush("legendColumn",7);L2_Ops._dPush("xGridColor","#ddd");L2_Ops._dPush("yGridColor","#ddd");L2_Ops._dPush("legendAt","nw");L2_Ops._dPush("xLabel","Rank");L2_Ops._dPush("yLabel","Cost");L2_Ops._dPush("linePen",1.2);L2_Ops._dPush("pointRadius",1.6);L2_Ops._dPush("color",new L2.Box(new L2.ArJSA(["#1e70ff","#00cc00"])._appendSc("#ee00ee","r")._appendSc("#33dddd","r")._appendSc("#ff0000","r")._appendSc("orange","r")));L2_Ops._dPush("xMin",0);L2_Ops._dPush("yMin",0);L2_Ops._dPush("put",0);L2_Ops["use:"]("r",L2_Par);var L2_Cost=L2.sc.unwrap(L2.sc._dEnt(L2_R._dEnt("cost"),"totalCost"));L2_Cost=L2_Cost["order"](new L2.ArJSA(["total"]))["slice"]("r",0,(L2_nMax||L2_Cost.r)-1);L2_Ops._dPush("yMax",L2_Cost._e(-1,"total")*1.1);L2.aux.plot(L2_Cost,"l",false,L2_Ops)};L2_Tile._dPush("plotCost",L2_plotCost);module.exports=L2_Tile})()},{"grid.js":2,"munkres.js":3,"polygon.js":4}]},{},[1]);
